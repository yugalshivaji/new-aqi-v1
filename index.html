<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQI NCR Delhi - Citizen Dashboard</title>
    <meta name="description" content="Advanced air quality monitoring with real-time data and complaint management">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Animate.css for smooth animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        :root {
            --primary: #0d6efd;
            --secondary: #6c757d;
            --success: #198754;
            --info: #0dcaf0;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-width: 280px;
            --header-height: 70px;
            --transition-speed: 0.3s;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* ===== LOADING ANIMATIONS ===== */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .loader-text {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 500;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* ===== MODERN HEADER ===== */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            width: 100%;
            height: var(--header-height);
            backdrop-filter: blur(10px);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .menu-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 1.4rem;
            margin-right: 15px;
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: all var(--transition-speed);
        }
        
        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.3rem;
            white-space: nowrap;
        }
        
        .logo-icon {
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 10px;
            margin-right: 12px;
            transition: transform var(--transition-speed);
        }
        
        .logo:hover .logo-icon {
            transform: rotate(15deg);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            flex: 1;
        }
        
        .header-icon {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            font-size: 1.2rem;
            margin-left: 12px;
            cursor: pointer;
            position: relative;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: all var(--transition-speed);
        }
        
        .header-icon:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            animation: pulse 1.5s infinite;
        }
        
        /* ===== MODERN SIDEBAR ===== */
        .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: var(--sidebar-width);
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 5px 0 25px rgba(0,0,0,0.1);
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            overflow-y: auto;
            padding-top: var(--header-height);
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .sidebar-overlay.open {
            display: block;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .sidebar-menu li {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: background-color var(--transition-speed);
        }
        
        .sidebar-menu li:hover {
            background: rgba(13, 110, 253, 0.05);
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 16px 25px;
            color: var(--dark);
            text-decoration: none;
            transition: all var(--transition-speed);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-menu a:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            transition: width var(--transition-speed);
            z-index: -1;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            color: white;
            padding-left: 30px;
        }
        
        .sidebar-menu a:hover:before, .sidebar-menu a.active:before {
            width: 100%;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
            font-size: 1.2rem;
            transition: transform var(--transition-speed);
        }
        
        .sidebar-menu a:hover i, .sidebar-menu a.active i {
            transform: scale(1.2);
        }
        
        /* ===== MAIN CONTENT AREA ===== */
        .main-content {
            flex: 1;
            padding: 30px;
            transition: margin-left var(--transition-speed);
            margin-top: var(--header-height);
            animation: fadeInUp 0.6s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ===== MODERN CARDS ===== */
        .dashboard-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .dashboard-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .dashboard-card:hover:before {
            transform: scaleX(1);
        }
        
        .card-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* ===== AQI COLOR SCHEMES ===== */
        .aqi-good { 
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
            color: white; 
        }
        .aqi-satisfactory { 
            background: linear-gradient(135deg, #87c159 0%, #6da53c 100%); 
            color: white; 
        }
        .aqi-moderate { 
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); 
            color: black; 
        }
        .aqi-poor { 
            background: linear-gradient(135deg, #fd7e14 0%, #e8590c 100%); 
            color: white; 
        }
        .aqi-very-poor { 
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); 
            color: white; 
        }
        .aqi-severe { 
            background: linear-gradient(135deg, #6f42c1 0%, #5a2d9c 100%); 
            color: white; 
        }
        
        /* ===== MAP CONTAINERS ===== */
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* ===== PHOTO CAPTURE STYLES ===== */
        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px;
        }
        
        .photo-preview-item {
            position: relative;
            width: 110px;
            height: 110px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }
        
        .photo-preview-item:hover {
            transform: scale(1.05);
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .photo-remove:hover {
            background: rgba(220, 53, 69, 1);
            transform: scale(1.1);
        }
        
        /* ===== STATUS BADGES ===== */
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .status-pending { background: #6c757d; color: white; }
        .status-in-progress { background: #0dcaf0; color: black; }
        .status-under-investigation { background: #ffc107; color: black; }
        .status-resolved { background: #198754; color: white; }
        .status-rejected { background: #dc3545; color: white; }
        
        .priority-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .priority-low { background: #6c757d; color: white; }
        .priority-medium { background: #ffc107; color: black; }
        .priority-high { background: #fd7e14; color: white; }
        .priority-critical { background: #dc3545; color: white; }
        
        /* ===== REAL-TIME INDICATOR ===== */
        .real-time-indicator {
            display: inline-flex;
            align-items: center;
            background: var(--success);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            box-shadow: 0 2px 8px rgba(25, 135, 84, 0.3);
            animation: pulse 2s infinite;
        }
        
        .real-time-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 1.5s infinite;
        }
        
        /* ===== NOTIFICATION & PROFILE PANELS ===== */
        .notification-panel, .profile-panel {
            position: fixed;
            top: var(--header-height);
            right: -350px;
            width: 320px;
            height: calc(100vh - var(--header-height));
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: -5px 0 25px rgba(0,0,0,0.1);
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 997;
            padding: 20px;
            overflow-y: auto;
        }
        
        .notification-panel.open, .profile-panel.open {
            right: 0;
        }
        
        .notification-item {
            padding: 15px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .notification-item:hover {
            background: rgba(13, 110, 253, 0.05);
            transform: translateX(5px);
        }
        
        .profile-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            margin: 0 auto 15px;
            box-shadow: 0 8px 20px rgba(13, 110, 253, 0.3);
            transition: transform 0.3s ease;
        }
        
        .profile-avatar:hover {
            transform: scale(1.05);
        }
        
        /* ===== CONTENT SECTIONS ===== */
        .content-section {
            display: none;
            animation: fadeInUp 0.5s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* ===== AUTHENTICATION STYLES ===== */
        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            margin: 50px auto;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.8s ease;
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            background: #f8f9fa;
        }
        
        .auth-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .auth-content {
            padding: 35px;
        }
        
        /* ===== VOICE ASSISTANT STYLES ===== */
        .voice-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            z-index: 1001;
            width: 90%;
            max-width: 450px;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .voice-panel.open {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .voice-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .voice-body {
            padding: 25px;
        }
        
        .voice-status {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: 600;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }
        
        .voice-status.listening {
            background: rgba(13, 110, 253, 0.1);
            border-color: var(--primary);
            color: var(--primary);
            animation: pulse 1.5s infinite;
        }
        
        /* ===== BREATHING EXERCISE STYLES ===== */
        .breathing-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            transition: all 4s ease-in-out;
            box-shadow: 0 10px 30px rgba(13, 110, 253, 0.3);
        }
        
        .breathing-text {
            text-align: center;
        }
        
        /* ===== POINTS BADGE ===== */
        .points-badge {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: black;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 10px;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }
        
        /* ===== CHATBOT STYLES ===== */
        .chatbot-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            z-index: 1002;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chatbot-panel.open {
            display: flex;
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .chatbot-footer {
            padding: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
        }
        
        .user-message {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: #f1f1f1;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .language-selector {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            margin-left: 10px;
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
            }
            
            .sidebar {
                position: static;
                width: var(--sidebar-width);
                height: 100vh;
                left: 0;
            }
            
            .main-content {
                flex: 1;
                margin-left: 0;
            }
            
            .menu-toggle {
                display: none;
            }
            
            .sidebar-overlay {
                display: none !important;
            }
        }
        
        @media (max-width: 767px) {
            .sidebar {
                width: 85%;
                max-width: 300px;
            }
            
            .app-header {
                padding: 10px 15px;
            }
            
            .logo {
                font-size: 1.1rem;
            }
            
            .header-icon {
                margin-left: 8px;
                font-size: 1.1rem;
            }
            
            .menu-toggle {
                margin-right: 8px;
                font-size: 1.2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .dashboard-card {
                margin-bottom: 20px;
            }
            
            .card-body {
                padding: 20px;
            }
            
            .chatbot-panel {
                width: 90%;
                height: 70%;
                right: 5%;
                bottom: 5%;
            }
        }
        
        @media (max-width: 480px) {
            .app-header {
                padding: 8px 12px;
            }
            
            .logo {
                font-size: 1rem;
            }
            
            .header-icon {
                margin-left: 6px;
                font-size: 1rem;
            }
            
            .menu-toggle {
                margin-right: 6px;
                font-size: 1.1rem;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .auth-container {
                margin: 30px auto;
                max-width: 90%;
            }
        }

        /* ===== PASSWORD TOGGLE ===== */
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            z-index: 10;
            color: #6c757d;
            transition: color 0.3s ease;
        }
        
        .password-toggle:hover {
            color: var(--primary);
        }
        
        .form-floating {
            position: relative;
        }

        /* ===== CUSTOM BUTTONS ===== */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.4);
        }
        
        /* ===== CUSTOM ALERTS ===== */
        .custom-alert {
            border-radius: 12px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        /* ===== POLICY RATING STYLES ===== */
        .rating-stars {
            color: #ffc107;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .rating-stars .star {
            margin-right: 5px;
        }
        
        /* ===== DEPARTMENT DASHBOARD STYLES ===== */
        .complaint-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .complaint-actions .btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .department-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* ===== AQI SHELTERS STYLES ===== */
        .shelter-card {
            border-left: 4px solid var(--primary);
        }
        
        .shelter-status {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 20px;
        }
        
        .shelter-available {
            background: var(--success);
            color: white;
        }
        
        .shelter-limited {
            background: var(--warning);
            color: black;
        }
        
        .shelter-full {
            background: var(--danger);
            color: white;
        }
        
        /* ===== INSURANCE STYLES ===== */
        .insurance-card {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .insurance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .insurance-feature {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .insurance-feature i {
            color: var(--success);
            margin-right: 10px;
        }
        
        /* ===== EVENTS STYLES ===== */
        .event-card {
            border-left: 4px solid var(--info);
        }
        
        .event-date {
            background: var(--info);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            text-align: center;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- ===== LOADING OVERLAY ===== -->
    <div class="loader-overlay" id="globalLoader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Loading AQI Dashboard...</div>
    </div>

    <!-- ===== AUTHENTICATION SECTION ===== -->
    <div id="auth-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10 col-lg-8">
                    <div class="auth-container">
                        <div class="auth-header">
                            <h1><i class="fas fa-wind me-2"></i>AQI NCR Delhi</h1>
                            <p class="mb-0">Advanced air quality monitoring with real-time data</p>
                        </div>
                        
                        <div class="auth-tabs">
                            <div class="auth-tab active" id="login-tab">Login</div>
                            <div class="auth-tab" id="register-tab">Register</div>
                            <div class="auth-tab" id="department-tab">Department</div>
                            <div class="auth-tab" id="policymaker-tab">Policymaker</div>
                        </div>
                        
                        <div class="auth-content">
                            <!-- Login Form -->
                            <div id="login-form" class="auth-panel">
                                <h3 class="text-center mb-4">Login to Your Account</h3>
                                
                                <div class="alert alert-info custom-alert">
                                    <strong>Demo Accounts:</strong><br>
                                    Username: <strong>demo</strong> | Password: <strong>demo123</strong><br>
                                    Username: <strong>admin</strong> | Password: <strong>admin123</strong><br>
                                    Username: <strong>user</strong> | Password: <strong>user123</strong>
                                </div>
                                
                                <form id="loginForm">
                                    <div class="mb-3">
                                        <label for="loginUsername" class="form-label">Username</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            <input type="text" class="form-control" id="loginUsername" placeholder="Enter your username" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="loginPassword" class="form-label">Password</label>
                                        <div class="form-floating">
                                            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                                            <span class="password-toggle" onclick="togglePassword('loginPassword')">
                                                <i class="fas fa-eye"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberMe">
                                        <label class="form-check-label" for="rememberMe">Remember me</label>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <span id="login-spinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
                                            Login
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Registration Form -->
                            <div id="register-form" class="auth-panel" style="display: none;">
                                <h3 class="text-center mb-4">Create Your Account</h3>
                                
                                <form id="registrationForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="fullName" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="fullName" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="username" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="username" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="mobile" class="form-label">Mobile Number</label>
                                            <input type="tel" class="form-control" id="mobile" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="password" class="form-label">Password</label>
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="password" required>
                                                <span class="password-toggle" onclick="togglePassword('password')">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="confirmPasswordReg" class="form-label">Confirm Password</label>
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="confirmPasswordReg" required>
                                                <span class="password-toggle" onclick="togglePassword('confirmPasswordReg')">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="terms" required>
                                        <label class="form-check-label" for="terms">I agree to the Terms of Service and Privacy Policy</label>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <span id="register-spinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
                                            Create Account
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Department Login Form -->
                            <div id="department-form" class="auth-panel" style="display: none;">
                                <h3 class="text-center mb-4">Department Login</h3>
                                
                                <div class="alert alert-info custom-alert">
                                    <strong>Department Demo Accounts:</strong><br>
                                    Username: <strong>dpcc</strong> | Password: <strong>dpcc123</strong><br>
                                    Username: <strong>transport</strong> | Password: <strong>transport123</strong><br>
                                    Username: <strong>environment</strong> | Password: <strong>environment123</strong>
                                </div>
                                
                                <form id="departmentLoginForm">
                                    <div class="mb-3">
                                        <label for="departmentUsername" class="form-label">Username</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-building"></i></span>
                                            <input type="text" class="form-control" id="departmentUsername" placeholder="Enter department username" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="departmentPassword" class="form-label">Password</label>
                                        <div class="form-floating">
                                            <input type="password" class="form-control" id="departmentPassword" placeholder="Enter department password" required>
                                            <span class="password-toggle" onclick="togglePassword('departmentPassword')">
                                                <i class="fas fa-eye"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberDept">
                                        <label class="form-check-label" for="rememberDept">Remember me</label>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-warning btn-lg">
                                            <span id="department-spinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
                                            Department Login
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Policymaker Login Form -->
                            <div id="policymaker-form" class="auth-panel" style="display: none;">
                                <h3 class="text-center mb-4">Policymaker Login</h3>
                                
                                <div class="alert alert-info custom-alert">
                                    <strong>Policymaker Demo Accounts:</strong><br>
                                    Username: <strong>policy</strong> | Password: <strong>policy123</strong><br>
                                    Username: <strong>admin</strong> | Password: <strong>admin123</strong>
                                </div>
                                
                                <form id="policymakerLoginForm">
                                    <div class="mb-3">
                                        <label for="policymakerUsername" class="form-label">Username</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user-tie"></i></span>
                                            <input type="text" class="form-control" id="policymakerUsername" placeholder="Enter policymaker username" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="policymakerPassword" class="form-label">Password</label>
                                        <div class="form-floating">
                                            <input type="password" class="form-control" id="policymakerPassword" placeholder="Enter policymaker password" required>
                                            <span class="password-toggle" onclick="togglePassword('policymakerPassword')">
                                                <i class="fas fa-eye"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberPolicy">
                                        <label class="form-check-label" for="rememberPolicy">Remember me</label>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-info btn-lg">
                                            <span id="policymaker-spinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
                                            Policymaker Login
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== DASHBOARD SECTION ===== -->
    <div id="dashboard-section" class="app-container" style="display: none;">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <ul class="sidebar-menu" id="sidebarMenu">
                <!-- Citizen Menu -->
                <li class="citizen-menu"><a href="#" class="active" data-section="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                <li class="citizen-menu"><a href="#" data-section="complaints"><i class="fas fa-exclamation-triangle"></i> Submit Complaint</a></li>
                <li class="citizen-menu"><a href="#" data-section="tracking"><i class="fas fa-tasks"></i> Complaint Tracking</a></li>
                <li class="citizen-menu"><a href="#" data-section="map"><i class="fas fa-map-marked-alt"></i> AQI Map</a></li>
                <li class="citizen-menu"><a href="#" data-section="hospitals"><i class="fas fa-hospital"></i> Nearby Hospitals</a></li>
                <li class="citizen-menu"><a href="#" data-section="shelters"><i class="fas fa-shield-alt"></i> AQI Shelters</a></li>
                <li class="citizen-menu"><a href="#" data-section="insurance"><i class="fas fa-file-medical"></i> Health Insurance</a></li>
                <li class="citizen-menu"><a href="#" data-section="events"><i class="fas fa-calendar-alt"></i> Events</a></li>
                <li class="citizen-menu"><a href="#" data-section="ar"><i class="fas fa-vr-cardboard"></i> AR Vision</a></li>
                <li class="citizen-menu"><a href="#" data-section="health"><i class="fas fa-lungs"></i> Health & Breathing</a></li>
                <li class="citizen-menu"><a href="#" data-section="policy-rating"><i class="fas fa-star"></i> Policy Rating</a></li>
                <li class="citizen-menu"><a href="#" data-section="profile"><i class="fas fa-user-cog"></i> Profile Settings</a></li>
                
                <!-- Department Menu -->
                <li class="department-menu" style="display: none;"><a href="#" data-section="department-dashboard"><i class="fas fa-tachometer-alt"></i> Department Dashboard</a></li>
                <li class="department-menu" style="display: none;"><a href="#" data-section="complaint-management"><i class="fas fa-tasks"></i> Complaint Management</a></li>
                <li class="department-menu" style="display: none;"><a href="#" data-section="department-reports"><i class="fas fa-chart-bar"></i> Reports</a></li>
                <li class="department-menu" style="display: none;"><a href="#" data-section="shelters"><i class="fas fa-shield-alt"></i> AQI Shelters</a></li>
                <li class="department-menu" style="display: none;"><a href="#" data-section="events"><i class="fas fa-calendar-alt"></i> Events</a></li>
                <li class="department-menu" style="display: none;"><a href="#" data-section="policy-rating"><i class="fas fa-star"></i> Policy Rating</a></li>
                <li class="department-menu" style="display: none;"><a href="#" data-section="profile"><i class="fas fa-user-cog"></i> Profile Settings</a></li>
                
                <!-- Policymaker Menu -->
                <li class="policymaker-menu" style="display: none;"><a href="#" data-section="policymaker-dashboard"><i class="fas fa-chart-line"></i> Policy Dashboard</a></li>
                <li class="policymaker-menu" style="display: none;"><a href="#" data-section="policy-analysis"><i class="fas fa-analytics"></i> Policy Analysis</a></li>
                <li class="policymaker-menu" style="display: none;"><a href="#" data-section="feedback-analysis"><i class="fas fa-comments"></i> Citizen Feedback</a></li>
                <li class="policymaker-menu" style="display: none;"><a href="#" data-section="shelters"><i class="fas fa-shield-alt"></i> AQI Shelters</a></li>
                <li class="policymaker-menu" style="display: none;"><a href="#" data-section="events"><i class="fas fa-calendar-alt"></i> Events</a></li>
                <li class="policymaker-menu" style="display: none;"><a href="#" data-section="profile"><i class="fas fa-user-cog"></i> Profile Settings</a></li>
                
                <!-- Common Menu Items -->
                <li><a href="#" id="logout-sidebar"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </aside>
        
        <!-- Main Content Area -->
        <div class="main-content" id="mainContent">
            <!-- Header Section -->
            <section class="content-section active" id="dashboard-section-content">
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <h1 class="display-5 fw-bold text-primary">Air Quality Dashboard</h1>
                        <p class="lead text-muted">Real-time monitoring & health recommendations</p>
                        <div class="d-flex justify-content-center align-items-center">
                            <small class="text-muted">Last updated: <span id="lastUpdated">Loading...</span></small>
                            <span class="real-time-indicator">Live</span>
                        </div>
                    </div>
                </div>

                <!-- Alert Section -->
                <div class="row mb-4" id="healthAlert" style="display: none;">
                    <div class="col-12">
                        <div class="alert alert-warning d-flex align-items-center custom-alert" role="alert">
                            <i class="fas fa-exclamation-triangle me-3 fa-2x"></i>
                            <div>
                                <h5 class="alert-heading mb-1" id="alertTitle">Health Alert</h5>
                                <p class="mb-0" id="alertMessage">Current air quality may affect sensitive individuals.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main AQI Display -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-body text-center py-5">
                                <h3 class="text-muted mb-3">Current AQI - Delhi NCR</h3>
                                <div class="display-1 fw-bold mb-3" id="mainAQI">--</div>
                                <div class="badge fs-5 px-4 py-2 mb-4" id="mainAQICategory">Loading...</div>
                                <div class="progress mb-3" style="height: 12px;">
                                    <div class="progress-bar" role="progressbar" id="aqiProgress"></div>
                                </div>
                                <p class="text-muted mb-2" id="aqiDescription">Fetching real-time data...</p>
                                <p class="text-muted small" id="dominantPollutant"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather & Pollutant Stats -->
                <div class="row mb-4">
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-thermometer-half fa-2x text-info mb-3"></i>
                                <h5>Temperature</h5>
                                <div class="h4 fw-bold" id="temperature">--C</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-wind fa-2x text-primary mb-3"></i>
                                <h5>Wind Speed</h5>
                                <div class="h4 fw-bold" id="windSpeed">-- m/s</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-tint fa-2x text-success mb-3"></i>
                                <h5>Humidity</h5>
                                <div class="h4 fw-bold" id="humidity">--%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-eye fa-2x text-warning mb-3"></i>
                                <h5>Visibility</h5>
                                <div class="h4 fw-bold" id="visibility">-- km</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pollutant Breakdown -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h4 class="mb-0"><i class="fas fa-flask me-2"></i>Pollutant Levels</h4>
                            </div>
                            <div class="card-body">
                                <div class="row" id="pollutantLevels">
                                    <div class="col-12 text-center">
                                        <div class="spinner-border text-primary"></div>
                                        <p class="mt-2">Loading pollutant data...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Source Attribution -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h4 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Pollution Source Analysis</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <canvas id="sourceChart" height="250"></canvas>
                                    </div>
                                    <div class="col-md-6">
                                        <div id="sourceBreakdown">
                                            <div class="text-center text-muted">
                                                <div class="spinner-border text-primary"></div>
                                                <p class="mt-2">Loading source analysis...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health Recommendations -->
                <div class="row mb-4">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-heart me-2"></i>Health Recommendations</h5>
                            </div>
                            <div class="card-body">
                                <div id="healthRecommendations">
                                    <p>Loading health recommendations based on current AQI...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Activity Suggestions</h5>
                            </div>
                            <div class="card-body">
                                <div id="activitySuggestions">
                                    <p>Loading activity suggestions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AQI Forecast -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h4 class="mb-0"><i class="fas fa-chart-line me-2"></i>72-Hour AQI Forecast</h4>
                            </div>
                            <div class="card-body">
                                <canvas id="forecastChart" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===== OTHER SECTIONS ===== -->
            
            <!-- Submit Complaint Section -->
            <section class="content-section" id="complaints-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-exclamation-triangle me-2"></i>Submit Complaint</h2>
                        <p class="text-muted">Report environmental violations with photo evidence</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Complaint Form</h4>
                    </div>
                    <div class="card-body">
                        <form id="complaintForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="complaintType" class="form-label">Complaint Type</label>
                                    <select class="form-select" id="complaintType" required>
                                        <option value="">Select type</option>
                                        <option value="industrial_pollution">Industrial Pollution</option>
                                        <option value="vehicle_emission">Vehicle Emission</option>
                                        <option value="construction_dust">Construction Dust</option>
                                        <option value="waste_burning">Waste Burning</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="priority" class="form-label">Priority</label>
                                    <select class="form-select" id="priority" required>
                                        <option value="">Select priority</option>
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                        <option value="critical">Critical</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="location" placeholder="Enter location" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" rows="4" placeholder="Describe the issue in detail" required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Upload Evidence (Photos)</label>
                                <div class="photo-preview" id="photoPreview"></div>
                                <input type="file" class="form-control" id="photoUpload" accept="image/*" multiple>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-paper-plane me-2"></i>Submit Complaint
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Complaint Tracking Section -->
            <section class="content-section" id="tracking-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-tasks me-2"></i>Complaint Tracking</h2>
                        <p class="text-muted">Monitor your complaint status and tracking history</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Your Complaints</h4>
                    </div>
                    <div class="card-body">
                        <div id="complaintsList">
                            <div class="text-center text-muted py-4">
                                <div class="spinner-border text-primary"></div>
                                <p class="mt-2">Loading your complaints...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AQI Shelters Section -->
            <section class="content-section" id="shelters-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-shield-alt me-2"></i>AQI Shelters</h2>
                        <p class="text-muted">Find clean air shelters during high pollution days</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Available Shelters</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            AQI Shelters provide clean air environments during severe pollution episodes. They are equipped with air purifiers and medical assistance.
                        </div>
                        
                        <div id="sheltersList">
                            <div class="shelter-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-1">Central Delhi Shelter</h5>
                                        <p class="mb-1 text-muted">Connaught Place, New Delhi</p>
                                        <p class="mb-0"><i class="fas fa-user me-1"></i> Capacity: 50 people</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="shelter-status shelter-available">Available</span>
                                        <p class="mb-0 mt-1"><small>2.5 km away</small></p>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="badge bg-primary me-1"><i class="fas fa-wind me-1"></i> Air Purifiers</span>
                                    <span class="badge bg-success me-1"><i class="fas fa-user-md me-1"></i> Medical Staff</span>
                                    <span class="badge bg-info me-1"><i class="fas fa-mask me-1"></i> Masks Available</span>
                                </div>
                            </div>
                            
                            <div class="shelter-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-1">South Delhi Shelter</h5>
                                        <p class="mb-1 text-muted">Saket, New Delhi</p>
                                        <p class="mb-0"><i class="fas fa-user me-1"></i> Capacity: 35 people</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="shelter-status shelter-limited">Limited</span>
                                        <p class="mb-0 mt-1"><small>4.2 km away</small></p>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="badge bg-primary me-1"><i class="fas fa-wind me-1"></i> Air Purifiers</span>
                                    <span class="badge bg-success me-1"><i class="fas fa-user-md me-1"></i> Medical Staff</span>
                                    <span class="badge bg-info me-1"><i class="fas fa-mask me-1"></i> Masks Available</span>
                                </div>
                            </div>
                            
                            <div class="shelter-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-1">East Delhi Shelter</h5>
                                        <p class="mb-1 text-muted">Preet Vihar, Delhi</p>
                                        <p class="mb-0"><i class="fas fa-user me-1"></i> Capacity: 40 people</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="shelter-status shelter-full">Full</span>
                                        <p class="mb-0 mt-1"><small>6.1 km away</small></p>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="badge bg-primary me-1"><i class="fas fa-wind me-1"></i> Air Purifiers</span>
                                    <span class="badge bg-success me-1"><i class="fas fa-user-md me-1"></i> Medical Staff</span>
                                    <span class="badge bg-info me-1"><i class="fas fa-mask me-1"></i> Masks Available</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>Shelter Guidelines</h5>
                            <ul>
                                <li>Shelters are activated when AQI exceeds 300 (Very Poor)</li>
                                <li>Carry identification proof for registration</li>
                                <li>Medical assistance is available for respiratory issues</li>
                                <li>Stay duration is limited to 4 hours during peak pollution</li>
                                <li>Children and elderly are given priority</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Health Insurance Section -->
            <section class="content-section" id="insurance-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-file-medical me-2"></i>Health Insurance</h2>
                        <p class="text-muted">Pollution-related health insurance plans</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Available Insurance Plans</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Special health insurance plans covering pollution-related illnesses. These plans provide coverage for respiratory treatments, hospitalizations, and preventive care.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="insurance-card p-4 h-100">
                                    <div class="text-center mb-3">
                                        <h4 class="text-primary">Basic Protection</h4>
                                        <h2 class="text-success">5,000/year</h2>
                                    </div>
                                    <div class="mb-3">
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Coverage for respiratory treatments</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Hospitalization up to 1 Lakh</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Doctor consultations (10 per year)</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Basic diagnostic tests</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary w-100">Select Plan</button>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="insurance-card p-4 h-100">
                                    <div class="text-center mb-3">
                                        <h4 class="text-primary">Comprehensive Care</h4>
                                        <h2 class="text-success">12,000/year</h2>
                                    </div>
                                    <div class="mb-3">
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Full respiratory illness coverage</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Hospitalization up to 5 Lakhs</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Unlimited doctor consultations</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Advanced diagnostic tests</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Preventive health checkups</span>
                                        </div>
                                        <div class="insurance-feature">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Air purifier rental subsidy</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary w-100">Select Plan</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>Insurance Benefits</h5>
                            <ul>
                                <li>Coverage for asthma, bronchitis, and other pollution-related conditions</li>
                                <li>Cashless hospitalization at network hospitals</li>
                                <li>Pre and post hospitalization expenses</li>
                                <li>Ambulance services coverage</li>
                                <li>No claim bonus for claim-free years</li>
                            </ul>
                            
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Note:</strong> Pre-existing conditions may have waiting periods. Please read the policy document carefully before purchasing.
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Events Section -->
            <section class="content-section" id="events-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-calendar-alt me-2"></i>Events</h2>
                        <p class="text-muted">Environmental awareness events and activities</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Upcoming Events</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Participate in environmental events to learn more about air quality and contribute to pollution control efforts.
                        </div>
                        
                        <div id="eventsList">
                            <div class="event-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="mb-1">Clean Air Awareness Workshop</h5>
                                        <p class="mb-1 text-muted"><i class="fas fa-map-marker-alt me-1"></i> India Habitat Centre, Lodhi Road</p>
                                        <p class="mb-2">Learn about air pollution sources, health impacts, and preventive measures from environmental experts.</p>
                                        <div>
                                            <span class="badge bg-primary me-1">Workshop</span>
                                            <span class="badge bg-success me-1">Free</span>
                                            <span class="badge bg-info me-1">All Ages</span>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="event-date mb-2">
                                            <div class="fw-bold">15</div>
                                            <div>NOV</div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">Register</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="event-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="mb-1">Tree Plantation Drive</h5>
                                        <p class="mb-1 text-muted"><i class="fas fa-map-marker-alt me-1"></i> Sanjay Van, Near Qutub Minar</p>
                                        <p class="mb-2">Join us in planting 5000 saplings to combat air pollution. Saplings and tools will be provided.</p>
                                        <div>
                                            <span class="badge bg-success me-1">Volunteering</span>
                                            <span class="badge bg-primary me-1">Outdoor</span>
                                            <span class="badge bg-info me-1">Family Friendly</span>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="event-date mb-2">
                                            <div class="fw-bold">20</div>
                                            <div>NOV</div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">Register</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="event-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="mb-1">Electric Vehicle Expo</h5>
                                        <p class="mb-1 text-muted"><i class="fas fa-map-marker-alt me-1"></i> Pragati Maidan, New Delhi</p>
                                        <p class="mb-2">Explore the latest electric vehicles and learn about government subsidies for EV adoption.</p>
                                        <div>
                                            <span class="badge bg-warning me-1">Exhibition</span>
                                            <span class="badge bg-success me-1">Free Entry</span>
                                            <span class="badge bg-info me-1">Technology</span>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="event-date mb-2">
                                            <div class="fw-bold">25</div>
                                            <div>NOV</div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">Register</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="event-card p-3 mb-3 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="mb-1">Policy Discussion: Air Quality Standards</h5>
                                        <p class="mb-1 text-muted"><i class="fas fa-map-marker-alt me-1"></i> PHD House, August Kranti Marg</p>
                                        <p class="mb-2">Interactive session with policymakers on implementing stricter air quality standards.</p>
                                        <div>
                                            <span class="badge bg-info me-1">Seminar</span>
                                            <span class="badge bg-primary me-1">Policy</span>
                                            <span class="badge bg-success me-1">Expert Panel</span>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="event-date mb-2">
                                            <div class="fw-bold">30</div>
                                            <div>NOV</div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">Register</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Policy Rating Section -->
            <section class="content-section" id="policy-rating-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-star me-2"></i>Policy Rating</h2>
                        <p class="text-muted">Rate government policies and provide feedback</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Rate Current Policies</h4>
                    </div>
                    <div class="card-body">
                        <div id="policiesList">
                            <div class="policy-item border-bottom pb-4 mb-4">
                                <h5>Odd-Even Vehicle Policy</h5>
                                <p class="text-muted">Restricts vehicles based on license plate numbers to reduce traffic congestion and emissions.</p>
                                <div class="rating-section mb-3">
                                    <label class="form-label">Rate this policy:</label>
                                    <div class="rating-stars" data-policy="odd-even">
                                        <span class="star" data-rating="1"></span>
                                        <span class="star" data-rating="2"></span>
                                        <span class="star" data-rating="3"></span>
                                        <span class="star" data-rating="4"></span>
                                        <span class="star" data-rating="5"></span>
                                    </div>
                                    <small class="text-muted" id="odd-even-rating-text">Not rated yet</small>
                                </div>
                                <div class="mb-3">
                                    <label for="odd-even-feedback" class="form-label">Your Feedback</label>
                                    <textarea class="form-control" id="odd-even-feedback" rows="2" placeholder="Share your experience with this policy"></textarea>
                                </div>
                                <button class="btn btn-primary btn-sm" onclick="submitPolicyRating('odd-even')">Submit Rating</button>
                            </div>
                            
                            <div class="policy-item border-bottom pb-4 mb-4">
                                <h5>GRAP (Graded Response Action Plan)</h5>
                                <p class="text-muted">Emergency measures implemented based on air quality levels to combat pollution.</p>
                                <div class="rating-section mb-3">
                                    <label class="form-label">Rate this policy:</label>
                                    <div class="rating-stars" data-policy="grap">
                                        <span class="star" data-rating="1"></span>
                                        <span class="star" data-rating="2"></span>
                                        <span class="star" data-rating="3"></span>
                                        <span class="star" data-rating="4"></span>
                                        <span class="star" data-rating="5"></span>
                                    </div>
                                    <small class="text-muted" id="grap-rating-text">Not rated yet</small>
                                </div>
                                <div class="mb-3">
                                    <label for="grap-feedback" class="form-label">Your Feedback</label>
                                    <textarea class="form-control" id="grap-feedback" rows="2" placeholder="Share your experience with this policy"></textarea>
                                </div>
                                <button class="btn btn-primary btn-sm" onclick="submitPolicyRating('grap')">Submit Rating</button>
                            </div>
                            
                            <div class="policy-item">
                                <h5>Electric Vehicle Promotion</h5>
                                <p class="text-muted">Subsidies and infrastructure development to encourage adoption of electric vehicles.</p>
                                <div class="rating-section mb-3">
                                    <label class="form-label">Rate this policy:</label>
                                    <div class="rating-stars" data-policy="ev">
                                        <span class="star" data-rating="1"></span>
                                        <span class="star" data-rating="2"></span>
                                        <span class="star" data-rating="3"></span>
                                        <span class="star" data-rating="4"></span>
                                        <span class="star" data-rating="5"></span>
                                    </div>
                                    <small class="text-muted" id="ev-rating-text">Not rated yet</small>
                                </div>
                                <div class="mb-3">
                                    <label for="ev-feedback" class="form-label">Your Feedback</label>
                                    <textarea class="form-control" id="ev-feedback" rows="2" placeholder="Share your experience with this policy"></textarea>
                                </div>
                                <button class="btn btn-primary btn-sm" onclick="submitPolicyRating('ev')">Submit Rating</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Department Dashboard Section -->
            <section class="content-section" id="department-dashboard-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-tachometer-alt me-2"></i>Department Dashboard</h2>
                        <p class="text-muted">Complaint management and resolution tracking</p>
                    </div>
                </div>
                
                <div class="department-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-complaints">0</div>
                        <div class="stat-label">Total Complaints</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-complaints">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="inprogress-complaints">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="resolved-complaints">0</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Recent Complaints</h4>
                    </div>
                    <div class="card-body">
                        <div id="departmentComplaintsList">
                            <div class="text-center text-muted py-4">
                                <div class="spinner-border text-primary"></div>
                                <p class="mt-2">Loading complaints...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Complaint Management Section -->
            <section class="content-section" id="complaint-management-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-tasks me-2"></i>Complaint Management</h2>
                        <p class="text-muted">Update complaint status and assign to officers</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">All Complaints</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Type</th>
                                        <th>Location</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="complaintManagementTable">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted py-4">
                                            <div class="spinner-border text-primary"></div>
                                            <p class="mt-2">Loading complaints...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Department Reports Section -->
            <section class="content-section" id="department-reports-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-chart-bar me-2"></i>Department Reports</h2>
                        <p class="text-muted">Analysis and reporting on complaint resolution</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Monthly Performance</h4>
                    </div>
                    <div class="card-body">
                        <canvas id="departmentChart" height="100"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-card mt-4">
                    <div class="card-header">
                        <h4 class="mb-0">Annual Report Analysis</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-file-pdf me-2"></i>DPCC Annual Report 2021-22 Analysis</h5>
                            <p class="mb-2">Based on the official Delhi Pollution Control Committee report, here are key findings:</p>
                            <ul>
                                <li>PM2.5 levels decreased by 18% compared to previous year</li>
                                <li>Industrial emissions contributed 25% to overall pollution</li>
                                <li>Vehicle emissions remained the largest contributor at 40%</li>
                                <li>Construction activities contributed 15% to PM10 levels</li>
                                <li>Waste burning incidents reduced by 22% after strict enforcement</li>
                            </ul>
                            <a href="https://www.dpcc.delhigovt.nic.in/uploads/annual/Approved-Annual-Report-2021-22pdf-e686cd1917b5609ae01620f741899c5f.pdf" target="_blank" class="btn btn-sm btn-outline-primary">View Full Report</a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Policymaker Dashboard Section -->
            <section class="content-section" id="policymaker-dashboard-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-chart-line me-2"></i>Policy Dashboard</h2>
                        <p class="text-muted">Policy effectiveness and citizen feedback analysis</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Policy Performance Overview</h4>
                    </div>
                    <div class="card-body">
                        <canvas id="policyChart" height="100"></canvas>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="dashboard-card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">Policy Ratings</h5>
                            </div>
                            <div class="card-body">
                                <div id="policyRatingsList">
                                    <div class="text-center text-muted py-4">
                                        <div class="spinner-border text-primary"></div>
                                        <p class="mt-2">Loading policy ratings...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="dashboard-card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">Citizen Demographics</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="demographicsChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Policy Analysis Section -->
            <section class="content-section" id="policy-analysis-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-analytics me-2"></i>Policy Analysis</h2>
                        <p class="text-muted">Detailed analysis of policy impact and recommendations</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Policy Impact Assessment</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Odd-Even Policy</h5>
                                <ul>
                                    <li><strong>Effectiveness:</strong> 65%</li>
                                    <li><strong>Public Acceptance:</strong> 72%</li>
                                    <li><strong>AQI Impact:</strong> Reduced by 10-15% during implementation</li>
                                    <li><strong>Recommendation:</strong> Extend to commercial vehicles</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>GRAP Implementation</h5>
                                <ul>
                                    <li><strong>Effectiveness:</strong> 78%</li>
                                    <li><strong>Public Acceptance:</strong> 65%</li>
                                    <li><strong>AQI Impact:</strong> Reduced severe days by 25%</li>
                                    <li><strong>Recommendation:</strong> Improve public communication</li>
                                </ul>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5>EV Promotion</h5>
                                <ul>
                                    <li><strong>Effectiveness:</strong> 55%</li>
                                    <li><strong>Public Acceptance:</strong> 68%</li>
                                    <li><strong>AQI Impact:</strong> Long-term reduction potential</li>
                                    <li><strong>Recommendation:</strong> Increase charging infrastructure</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>Construction Regulations</h5>
                                <ul>
                                    <li><strong>Effectiveness:</strong> 70%</li>
                                    <li><strong>Public Acceptance:</strong> 60%</li>
                                    <li><strong>AQI Impact:</strong> Reduced PM10 by 12%</li>
                                    <li><strong>Recommendation:</strong> Stricter enforcement needed</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Feedback Analysis Section -->
            <section class="content-section" id="feedback-analysis-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-comments me-2"></i>Citizen Feedback Analysis</h2>
                        <p class="text-muted">Analysis of citizen ratings and feedback on policies</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Citizen Sentiment Analysis</h4>
                    </div>
                    <div class="card-body">
                        <canvas id="sentimentChart" height="100"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-card mt-4">
                    <div class="card-header">
                        <h4 class="mb-0">Recent Citizen Feedback</h4>
                    </div>
                    <div class="card-body">
                        <div id="citizenFeedbackList">
                            <div class="text-center text-muted py-4">
                                <div class="spinner-border text-primary"></div>
                                <p class="mt-2">Loading feedback...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ===== EXISTING SECTIONS (Map, Hospitals, AR, Health, Profile) ===== -->
            <!-- These sections remain the same as in the original code -->
            <!-- AQI Map Section -->
            <section class="content-section" id="map-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-map-marked-alt me-2"></i>AQI Map</h2>
                        <p class="text-muted">Real-time air quality across Delhi-NCR</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-body">
                        <div class="map-container" id="aqiMap"></div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h4 class="mb-0">AQI Legend</h4>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6 col-md-2 mb-2">
                                        <div class="aqi-good p-2 rounded">Good (0-50)</div>
                                    </div>
                                    <div class="col-6 col-md-2 mb-2">
                                        <div class="aqi-satisfactory p-2 rounded">Satisfactory (51-100)</div>
                                    </div>
                                    <div class="col-6 col-md-2 mb-2">
                                        <div class="aqi-moderate p-2 rounded">Moderate (101-200)</div>
                                    </div>
                                    <div class="col-6 col-md-2 mb-2">
                                        <div class="aqi-poor p-2 rounded">Poor (201-300)</div>
                                    </div>
                                    <div class="col-6 col-md-2 mb-2">
                                        <div class="aqi-very-poor p-2 rounded">Very Poor (301-400)</div>
                                    </div>
                                    <div class="col-6 col-md-2 mb-2">
                                        <div class="aqi-severe p-2 rounded">Severe (401-500)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Nearby Hospitals Section -->
            <section class="content-section" id="hospitals-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-hospital me-2"></i>Nearby Hospitals</h2>
                        <p class="text-muted">Find healthcare facilities near you</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0">Hospitals in Delhi-NCR</h4>
                    </div>
                    <div class="card-body">
                        <div id="hospitalsList">
                            <div class="text-center text-muted py-4">
                                <div class="spinner-border text-primary"></div>
                                <p class="mt-2">Loading hospitals data...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AR Vision Section -->
            <section class="content-section" id="ar-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-vr-cardboard me-2"></i>Smog-Scope AR View</h2>
                        <p class="text-muted">See pollution levels through augmented reality</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-body text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-vr-cardboard fa-5x text-primary mb-4"></i>
                            <h3>AR Pollution Visualization</h3>
                            <p class="text-muted">Point your camera to visualize pollution levels in your surroundings</p>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded bg-light">
                                    <h5>Current AQI Overlay</h5>
                                    <p class="mb-0">See real-time AQI values overlaid on buildings and landmarks</p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded bg-light">
                                    <h5>Pollution Hotspots</h5>
                                    <p class="mb-0">Identify areas with high pollution concentration</p>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-lg" id="startAR">
                            <i class="fas fa-camera me-2"></i>Start AR Experience
                        </button>
                        
                        <div class="mt-4 p-3 bg-light rounded">
                            <h5>How it works:</h5>
                            <ol class="text-start">
                                <li>Allow camera access when prompted</li>
                                <li>Point your device at your surroundings</li>
                                <li>See pollution data overlaid in real-time</li>
                                <li>Tap on hotspots for detailed information</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Health & Breathing Section -->
            <section class="content-section" id="health-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-lungs me-2"></i>Health & Breathing Exercises</h2>
                        <p class="text-muted">Improve your lung health with guided exercises</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-6 mb-4">
                        <div class="dashboard-card h-100">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-heartbeat me-2"></i>Health Assessment</h5>
                            </div>
                            <div class="card-body">
                                <form id="healthForm">
                                    <div class="mb-3">
                                        <label for="age" class="form-label">Age</label>
                                        <input type="number" class="form-control" id="age" min="1" max="120" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Do you have any respiratory conditions?</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="respiratoryCondition" id="respiratoryNo" value="no" checked>
                                            <label class="form-check-label" for="respiratoryNo">No</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="respiratoryCondition" id="respiratoryYes" value="yes">
                                            <label class="form-check-label" for="respiratoryYes">Yes</label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Do you smoke?</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="smoking" id="smokingNo" value="no" checked>
                                            <label class="form-check-label" for="smokingNo">No</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="smoking" id="smokingYes" value="yes">
                                            <label class="form-check-label" for="smokingYes">Yes</label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="activityLevel" class="form-label">Activity Level</label>
                                        <select class="form-select" id="activityLevel" required>
                                            <option value="sedentary">Sedentary</option>
                                            <option value="light">Lightly Active</option>
                                            <option value="moderate">Moderately Active</option>
                                            <option value="very">Very Active</option>
                                        </select>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary w-100">Get Health Recommendations</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="dashboard-card h-100">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-wind me-2"></i>Breathing Exercise</h5>
                            </div>
                            <div class="card-body text-center">
                                <div class="breathing-circle" id="breathingCircle">
                                    Breathe In
                                </div>
                                <div class="breathing-text mt-4">
                                    <h5 id="breathingInstruction">Breathe in through your nose</h5>
                                    <p class="text-muted" id="breathingTimer">Hold for 4 seconds</p>
                                </div>
                                <button class="btn btn-primary mt-3" id="startBreathing">
                                    <i class="fas fa-play me-2"></i>Start Exercise
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-file-medical-alt me-2"></i>Health Recommendations</h4>
                    </div>
                    <div class="card-body">
                        <div id="personalHealthRecommendations">
                            <p class="text-muted">Complete the health assessment to get personalized recommendations.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Settings Section -->
            <section class="content-section" id="profile-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold text-primary"><i class="fas fa-user-cog me-2"></i>Profile Settings</h2>
                        <p class="text-muted">Manage your account and preferences</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-6 mb-4">
                        <div class="dashboard-card h-100">
                            <div class="card-header">
                                <h4 class="mb-0">Personal Information</h4>
                            </div>
                            <div class="card-body">
                                <form id="profileForm">
                                    <div class="mb-3">
                                        <label for="profileFullName" class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="profileFullName">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="profileEmail" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="profileEmail">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="profileMobile" class="form-label">Mobile Number</label>
                                        <input type="tel" class="form-control" id="profileMobile">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="profileLocation" class="form-label">Location</label>
                                        <input type="text" class="form-control" id="profileLocation">
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="dashboard-card h-100">
                            <div class="card-header">
                                <h4 class="mb-0">Account Settings</h4>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <h5>Notification Preferences</h5>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyAQI" checked>
                                        <label class="form-check-label" for="notifyAQI">AQI Alerts</label>
                                    </div>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyHealth" checked>
                                        <label class="form-check-label" for="notifyHealth">Health Recommendations</label>
                                    </div>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyComplaint" checked>
                                        <label class="form-check-label" for="notifyComplaint">Complaint Updates</label>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h5>Change Password</h5>
                                    <form id="passwordForm">
                                        <div class="mb-3">
                                            <label for="currentPassword" class="form-label">Current Password</label>
                                            <input type="password" class="form-control" id="currentPassword">
                                        </div>
                                        <div class="mb-3">
                                            <label for="newPassword" class="form-label">New Password</label>
                                            <input type="password" class="form-control" id="newPassword">
                                        </div>
                                        <div class="mb-3">
                                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" id="confirmPassword">
                                        </div>
                                        <button type="submit" class="btn btn-warning">Change Password</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Danger Zone</h4>
                    </div>
                    <div class="card-body">
                        <p>Once you delete your account, there is no going back. Please be certain.</p>
                        <button class="btn btn-outline-danger" id="deleteAccount">
                            <i class="fas fa-trash-alt me-2"></i>Delete Account
                        </button>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-wind"></i>
                    </div>
                    AQI NCR Delhi
                    <span class="points-badge" id="headerPoints">0 pts</span>
                </div>
            </div>
            <div class="header-right">
                <button class="header-icon" id="translateBtn" title="Translate">
                    <i class="fas fa-language"></i>
                </button>
                <button class="header-icon" id="chatbotBtn">
                    <i class="fas fa-robot"></i>
                </button>
                <button class="header-icon" id="voiceAssistant">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="header-icon" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">0</span>
                </button>
                <button class="header-icon" id="profileBtn">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        </header>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Notifications</h5>
                <button class="btn btn-sm btn-outline-secondary" id="markAllRead">
                    <i class="fas fa-check-double me-1"></i>Mark All Read
                </button>
            </div>
            <div id="notificationPanelContent">
                <div class="text-center text-muted py-4">
                    <p>No new notifications</p>
                </div>
            </div>
        </div>
        
        <!-- Profile Panel -->
        <div class="profile-panel" id="profilePanel">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h5 id="profileUserName">User</h5>
                <p class="text-muted" id="profileUserLocation">Delhi, India</p>
                <div class="points-badge" id="profilePoints">0 pts</div>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <i class="fas fa-user me-2"></i>Edit Profile
                </li>
                <li class="list-group-item">
                    <i class="fas fa-bell me-2"></i>Notification Settings
                </li>
                <li class="list-group-item">
                    <i class="fas fa-shield-alt me-2"></i>Privacy & Security
                </li>
                <li class="list-group-item">
                    <i class="fas fa-question-circle me-2"></i>Help & Support
                </li>
                <li class="list-group-item text-danger" id="logout-profile">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </li>
            </ul>
        </div>

        <!-- Voice Assistant Panel -->
        <div class="voice-panel" id="voicePanel">
            <div class="voice-header">
                <h5 class="mb-0">AQI Vaani - Voice Assistant</h5>
                <button class="btn-close btn-close-white" id="closeVoice"></button>
            </div>
            <div class="voice-body">
                <div class="voice-status" id="voiceStatus">Click microphone to start</div>
                <div class="voice-commands">
                    <h6>Available Commands:</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-microphone me-2 text-primary"></i>"What is the AQI?"</li>
                        <li><i class="fas fa-microphone me-2 text-primary"></i>"Report pollution"</li>
                        <li><i class="fas fa-microphone me-2 text-primary"></i>"Hospitals near me"</li>
                        <li><i class="fas fa-microphone me-2 text-primary"></i>"Health tips"</li>
                        <li><i class="fas fa-microphone me-2 text-primary"></i>"My complaints"</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Chatbot Panel -->
        <div class="chatbot-panel" id="chatbotPanel">
            <div class="chatbot-header">
                <h5 class="mb-0">AQI Assistant</h5>
                <div>
                    <select class="language-selector" id="chatbotLanguage">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="bn">Bengali</option>
                        <option value="ta">Tamil</option>
                        <option value="te">Telugu</option>
                        <option value="mr">Marathi</option>
                    </select>
                    <button class="btn-close btn-close-white" id="closeChatbot"></button>
                </div>
            </div>
            <div class="chatbot-body" id="chatbotMessages">
                <div class="message bot-message">
                    Hello! I'm your AQI assistant. How can I help you today?
                </div>
            </div>
            <div class="chatbot-footer">
                <div class="input-group">
                    <input type="text" class="form-control" id="chatbotInput" placeholder="Type your message...">
                    <button class="btn btn-primary" id="sendChatbotMessage">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Translation Panel -->
        <div class="notification-panel" id="translationPanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Translate Page</h5>
                <button class="btn-close" id="closeTranslation"></button>
            </div>
            <div class="mb-3">
                <label for="translationLanguage" class="form-label">Select Language</label>
                <select class="form-select" id="translationLanguage">
                    <option value="en">English</option>
                    <option value="hi">Hindi</option>
                    <option value="bn">Bengali</option>
                    <option value="ta">Tamil</option>
                    <option value="te">Telugu</option>
                    <option value="mr">Marathi</option>
                    <option value="gu">Gujarati</option>
                    <option value="kn">Kannada</option>
                    <option value="ml">Malayalam</option>
                    <option value="pa">Punjabi</option>
                </select>
            </div>
            <button class="btn btn-primary w-100" id="applyTranslation">Apply Translation</button>
            <div class="mt-3">
                <small class="text-muted">Note: Translation is powered by Google Translate and may not be 100% accurate.</small>
            </div>
        </div>
    </div>

    <!-- ===== EXTERNAL LIBRARIES ===== -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Leaflet JS for maps -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ===== MOCK DATA =====
        const MOCK_USERS = [
            { username: 'demo', password: 'demo123', full_name: 'Demo User', email: 'demo@example.com', mobile: '9876543210', points: 150, role: 'citizen' },
            { username: 'admin', password: 'admin123', full_name: 'Admin User', email: 'admin@example.com', mobile: '9876543211', points: 300, role: 'citizen' },
            { username: 'user', password: 'user123', full_name: 'Test User', email: 'user@example.com', mobile: '9876543212', points: 75, role: 'citizen' }
        ];

        const MOCK_DEPARTMENTS = [
            { username: 'dpcc', password: 'dpcc123', name: 'Delhi Pollution Control Committee', email: 'dpcc@delhi.gov.in', role: 'department' },
            { username: 'transport', password: 'transport123', name: 'Transport Department', email: 'transport@delhi.gov.in', role: 'department' },
            { username: 'environment', password: 'environment123', name: 'Environment Department', email: 'environment@delhi.gov.in', role: 'department' }
        ];

        const MOCK_POLICYMAKERS = [
            { username: 'policy', password: 'policy123', name: 'Policy Analyst', email: 'policy@delhi.gov.in', role: 'policymaker' },
            { username: 'admin', password: 'admin123', name: 'Administrator', email: 'admin@delhi.gov.in', role: 'policymaker' }
        ];

        const MOCK_DASHBOARD_DATA = {
            success: true,
            data: {
                aqi: 245,
                dominantPollutant: 'PM2.5',
                healthMessage: 'Air quality is poor. Sensitive groups should reduce outdoor activities.',
                pm25: 105,
                pm10: 180,
                o3: 45,
                no2: 60,
                so2: 25,
                co: 1.2
            },
            weather: {
                temperature: 28,
                humidity: 65,
                wind_speed: 12,
                visibility: 4
            },
            source_attribution: {
                vehicle_emissions: 35,
                industrial_emissions: 25,
                construction_dust: 20,
                waste_burning: 15,
                other: 5
            },
            health_recommendations: [
                'Sensitive groups should reduce outdoor activities',
                'Keep windows and doors closed',
                'Use air purifiers indoors',
                'Wear N95 masks if going outside',
                'Stay hydrated and avoid strenuous activities'
            ],
            activity_suggestions: [
                'Indoor exercises recommended',
                'Limit outdoor activities to essential tasks only',
                'Avoid morning walks when pollution is highest',
                'Consider indoor recreational activities'
            ],
            forecast: [
                { hour: 0, aqi: 240 },
                { hour: 3, aqi: 235 },
                { hour: 6, aqi: 250 },
                { hour: 9, aqi: 280 },
                { hour: 12, aqi: 270 },
                { hour: 15, aqi: 260 },
                { hour: 18, aqi: 245 },
                { hour: 21, aqi: 230 }
            ],
            user_points: 150
        };

        const MOCK_COMPLAINTS = [
            {
                id: 1,
                type: 'industrial_pollution',
                priority: 'high',
                location: 'Okhla Industrial Area',
                description: 'Black smoke coming from factory chimney',
                status: 'pending',
                date: '2023-11-15',
                photos: [],
                department: 'dpcc',
                citizen: 'demo'
            },
            {
                id: 2,
                type: 'vehicle_emission',
                priority: 'medium',
                location: 'Connaught Place',
                description: 'Multiple vehicles emitting excessive smoke',
                status: 'in-progress',
                date: '2023-11-10',
                photos: [],
                department: 'transport',
                citizen: 'user'
            },
            {
                id: 3,
                type: 'waste_burning',
                priority: 'critical',
                location: 'Dwarka Sector 12',
                description: 'Large scale waste burning in open area',
                status: 'resolved',
                date: '2023-11-05',
                photos: [],
                department: 'environment',
                citizen: 'admin'
            },
            {
                id: 4,
                type: 'construction_dust',
                priority: 'high',
                location: 'Rohini Sector 15',
                description: 'Construction site without proper dust control measures',
                status: 'pending',
                date: '2023-11-20',
                photos: [],
                department: 'dpcc',
                citizen: 'demo'
            }
        ];

        const MOCK_POLICY_RATINGS = [
            {
                policy: 'odd-even',
                ratings: [4, 5, 3, 4, 5, 2, 4, 3, 5, 4],
                feedback: [
                    'Helped reduce traffic congestion during peak hours',
                    'Inconvenient for people with single vehicles',
                    'Should be implemented more frequently'
                ]
            },
            {
                policy: 'grap',
                ratings: [3, 4, 5, 4, 3, 4, 5, 4, 3, 4],
                feedback: [
                    'Effective during severe pollution days',
                    'Implementation could be better coordinated',
                    'Helped raise awareness about air quality'
                ]
            },
            {
                policy: 'ev',
                ratings: [4, 3, 4, 5, 4, 3, 4, 5, 4, 3],
                feedback: [
                    'Need more charging stations',
                    'Subsidies are helpful but not enough',
                    'Good initiative for long-term pollution control'
                ]
            }
        ];

        const MOCK_HOSPITALS = [
            {
                name: 'AIIMS Hospital',
                address: 'Ansari Nagar, New Delhi',
                distance: '2.5 km',
                phone: '011-26588585',
                specialties: ['Respiratory', 'Cardiology', 'Emergency']
            },
            {
                name: 'Safdarjung Hospital',
                address: 'Ansari Nagar East, New Delhi',
                distance: '3.2 km',
                phone: '011-26165060',
                specialties: ['Pulmonology', 'General Medicine', 'Pediatrics']
            },
            {
                name: 'Ram Manohar Lohia Hospital',
                address: 'Baba Kharak Singh Marg, New Delhi',
                distance: '4.1 km',
                phone: '011-23365525',
                specialties: ['Respiratory', 'Critical Care', 'Allergy']
            },
            {
                name: 'Sir Ganga Ram Hospital',
                address: 'Rajinder Nagar, New Delhi',
                distance: '5.7 km',
                phone: '011-25750000',
                specialties: ['Pulmonology', 'Cardiology', 'Internal Medicine']
            }
        ];

        const MOCK_NOTIFICATIONS = [
            {
                id: 1,
                title: 'High AQI Alert',
                message: 'AQI in your area has reached 245 (Poor)',
                time: '2 hours ago',
                read: false
            },
            {
                id: 2,
                title: 'Complaint Update',
                message: 'Your complaint #2 is now In Progress',
                time: '1 day ago',
                read: true
            },
            {
                id: 3,
                title: 'Health Tip',
                message: 'Consider wearing an N95 mask when going outside',
                time: '2 days ago',
                read: true
            }
        ];

        // ===== GLOBAL APPLICATION STATE =====
        let currentUser = null;
        let authToken = null;
        let dashboardRefreshInterval = null;
        let voiceAssistant = null;
        let charts = {};
        let map = null;
        let breathingExerciseInterval = null;
        let currentLanguage = 'en';

        // ===== UTILITY FUNCTIONS =====
        
        /**
         * Toggle password visibility in input fields
         * @param {string} inputId - The ID of the password input field
         */
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.parentElement.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        /**
         * Show a specific content section and hide others
         * @param {string} section - The section to show
         */
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Remove active class from all sidebar links
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show the selected section
            const sectionElement = document.getElementById(`${section}-section-content`);
            if (sectionElement) {
                sectionElement.classList.add('active');
                
                // Activate corresponding sidebar link
                document.querySelector(`[data-section="${section}"]`).classList.add('active');
                
                // Load section-specific data
                loadSectionData(section);
            }
        }
        
        /**
         * Load data for a specific section
         * @param {string} section - The section to load data for
         */
        function loadSectionData(section) {
            switch(section) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'complaints':
                    initializeComplaintForm();
                    break;
                case 'tracking':
                    loadUserComplaints();
                    break;
                case 'shelters':
                    loadAQIShelters();
                    break;
                case 'insurance':
                    loadInsurancePlans();
                    break;
                case 'events':
                    loadEvents();
                    break;
                case 'policy-rating':
                    initializePolicyRating();
                    break;
                case 'department-dashboard':
                    loadDepartmentDashboard();
                    break;
                case 'complaint-management':
                    loadComplaintManagement();
                    break;
                case 'department-reports':
                    loadDepartmentReports();
                    break;
                case 'policymaker-dashboard':
                    loadPolicymakerDashboard();
                    break;
                case 'policy-analysis':
                    loadPolicyAnalysis();
                    break;
                case 'feedback-analysis':
                    loadFeedbackAnalysis();
                    break;
                case 'map':
                    initializeAQIMap();
                    break;
                case 'hospitals':
                    loadNearbyHospitals();
                    break;
                case 'ar':
                    initializeARView();
                    break;
                case 'health':
                    loadHealthData();
                    break;
                case 'profile':
                    loadProfileData();
                    break;
            }
        }
        
        /**
         * Show alert message to user
         * @param {string} message - The message to display
         * @param {string} type - The type of alert (success, error, warning, info)
         */
        function showAlert(message, type = 'info') {
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.custom-alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';
            
            const alertHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show custom-alert" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.querySelector('.main-content').insertAdjacentHTML('afterbegin', alertHtml);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                const alert = document.querySelector('.custom-alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }
        
        /**
         * Show loading spinner in a button
         * @param {string} elementId - The ID of the button element
         */
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'inline-block';
            }
        }
        
        /**
         * Hide loading spinner in a button
         * @param {string} elementId - The ID of the button element
         */
        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'none';
            }
        }
        
        /**
         * Toggle sidebar visibility (mobile)
         */
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('open');
        }
        
        /**
         * Toggle notification panel visibility
         */
        function toggleNotificationPanel() {
            document.getElementById('notificationPanel').classList.toggle('open');
            document.getElementById('profilePanel').classList.remove('open');
            document.getElementById('translationPanel').classList.remove('open');
        }
        
        /**
         * Toggle profile panel visibility
         */
        function toggleProfilePanel() {
            document.getElementById('profilePanel').classList.toggle('open');
            document.getElementById('notificationPanel').classList.remove('open');
            document.getElementById('translationPanel').classList.remove('open');
        }
        
        /**
         * Toggle translation panel visibility
         */
        function toggleTranslationPanel() {
            document.getElementById('translationPanel').classList.toggle('open');
            document.getElementById('notificationPanel').classList.remove('open');
            document.getElementById('profilePanel').classList.remove('open');
        }
        
        /**
         * Toggle chatbot panel visibility
         */
        function toggleChatbotPanel() {
            document.getElementById('chatbotPanel').classList.toggle('open');
        }
        
        /**
         * Toggle voice assistant panel visibility
         */
        function toggleVoicePanel() {
            const voicePanel = document.getElementById('voicePanel');
            voicePanel.classList.toggle('open');
            
            if (voicePanel.classList.contains('open')) {
                startVoiceRecognition();
            } else {
                stopVoiceRecognition();
            }
        }

        // ===== MOCK API SERVICE =====
        
        class MockApiService {
            /**
             * Mock user login
             * @param {string} username - Username
             * @param {string} password - Password
             * @param {string} role - User role
             * @returns {Object} - Login result
             */
            static async login(username, password, role = 'citizen') {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                let user;
                
                if (role === 'citizen') {
                    user = MOCK_USERS.find(u => u.username === username && u.password === password);
                } else if (role === 'department') {
                    user = MOCK_DEPARTMENTS.find(u => u.username === username && u.password === password);
                } else if (role === 'policymaker') {
                    user = MOCK_POLICYMAKERS.find(u => u.username === username && u.password === password);
                }
                
                if (user) {
                    return {
                        success: true,
                        user: { ...user, password: undefined },
                        access_token: 'mock_jwt_token_' + Date.now()
                    };
                } else {
                    return {
                        success: false,
                        detail: 'Invalid username or password'
                    };
                }
            }
            
            /**
             * Mock user registration
             * @param {Object} userData - User registration data
             * @returns {Object} - Registration result
             */
            static async register(userData) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Check if username already exists
                if (MOCK_USERS.find(u => u.username === userData.username)) {
                    return {
                        success: false,
                        detail: 'Username already exists'
                    };
                }
                
                // Create new user
                const newUser = {
                    ...userData,
                    points: 0,
                    role: 'citizen'
                };
                
                MOCK_USERS.push(newUser);
                
                return {
                    success: true,
                    user: { ...newUser, password: undefined },
                    access_token: 'mock_jwt_token_' + Date.now()
                };
            }
            
            /**
             * Mock dashboard data
             * @returns {Object} - Dashboard data
             */
            static async getDashboardData() {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Return slightly modified data to simulate real-time changes
                const modifiedData = JSON.parse(JSON.stringify(MOCK_DASHBOARD_DATA));
                modifiedData.data.aqi = Math.floor(200 + Math.random() * 100);
                modifiedData.user_points = currentUser ? currentUser.points : 0;
                
                return modifiedData;
            }
            
            /**
             * Mock complaint submission
             * @param {Object} complaintData - Complaint data
             * @returns {Object} - Submission result
             */
            static async submitComplaint(complaintData) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Add complaint to mock data
                const newComplaint = {
                    id: MOCK_COMPLAINTS.length + 1,
                    ...complaintData,
                    status: 'pending',
                    date: new Date().toISOString().split('T')[0],
                    citizen: currentUser ? currentUser.username : 'demo'
                };
                
                MOCK_COMPLAINTS.unshift(newComplaint);
                
                // Add points to user
                if (currentUser && currentUser.role === 'citizen') {
                    currentUser.points += 10;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                return {
                    success: true,
                    complaint_id: newComplaint.id,
                    message: 'Complaint submitted successfully'
                };
            }
            
            /**
             * Mock user complaints
             * @returns {Object} - User complaints
             */
            static async getUserComplaints() {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 600));
                
                const userComplaints = currentUser ? 
                    MOCK_COMPLAINTS.filter(c => c.citizen === currentUser.username) : 
                    MOCK_COMPLAINTS;
                
                return {
                    success: true,
                    complaints: userComplaints
                };
            }
            
            /**
             * Mock all complaints for department view
             * @returns {Object} - All complaints
             */
            static async getAllComplaints() {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 600));
                
                return {
                    success: true,
                    complaints: MOCK_COMPLAINTS
                };
            }
            
            /**
             * Mock update complaint status
             * @param {number} complaintId - Complaint ID
             * @param {string} status - New status
             * @param {string} department - Department handling the complaint
             * @returns {Object} - Update result
             */
            static async updateComplaintStatus(complaintId, status, department = null) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const complaint = MOCK_COMPLAINTS.find(c => c.id === complaintId);
                if (complaint) {
                    complaint.status = status;
                    if (department) {
                        complaint.department = department;
                    }
                    
                    return {
                        success: true,
                        message: 'Complaint status updated successfully'
                    };
                } else {
                    return {
                        success: false,
                        detail: 'Complaint not found'
                    };
                }
            }
            
            /**
             * Mock policy rating submission
             * @param {string} policy - Policy name
             * @param {number} rating - Rating value (1-5)
             * @param {string} feedback - User feedback
             * @returns {Object} - Submission result
             */
            static async submitPolicyRating(policy, rating, feedback) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const policyData = MOCK_POLICY_RATINGS.find(p => p.policy === policy);
                if (policyData) {
                    policyData.ratings.push(rating);
                    if (feedback) {
                        policyData.feedback.push(feedback);
                    }
                    
                    // Add points to user
                    if (currentUser && currentUser.role === 'citizen') {
                        currentUser.points += 5;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    }
                    
                    return {
                        success: true,
                        message: 'Policy rating submitted successfully'
                    };
                } else {
                    return {
                        success: false,
                        detail: 'Policy not found'
                    };
                }
            }
            
            /**
             * Mock policy ratings data
             * @returns {Object} - Policy ratings
             */
            static async getPolicyRatings() {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 700));
                
                return {
                    success: true,
                    ratings: MOCK_POLICY_RATINGS
                };
            }
            
            /**
             * Mock nearby hospitals
             * @returns {Object} - Hospital data
             */
            static async getNearbyHospitals() {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 700));
                
                return {
                    success: true,
                    hospitals: MOCK_HOSPITALS
                };
            }
            
            /**
             * Mock notifications
             * @returns {Object} - Notifications data
             */
            static async getNotifications() {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                return {
                    success: true,
                    notifications: MOCK_NOTIFICATIONS
                };
            }
            
            /**
             * Mock voice command processing
             * @param {Object} commandData - Voice command data
             * @returns {Object} - Command response
             */
            static async processVoiceCommand(commandData) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const command = commandData.command.toLowerCase();
                let response = "I'm sorry, I didn't understand that command.";
                
                if (command.includes('aqi') || command.includes('air quality')) {
                    response = `The current AQI in Delhi is ${MOCK_DASHBOARD_DATA.data.aqi}, which is considered Poor. Sensitive groups should reduce outdoor activities.`;
                } else if (command.includes('complaint') || command.includes('report')) {
                    response = "You can submit a pollution complaint through the Submit Complaint section. I can help you file a report if you'd like.";
                } else if (command.includes('hospital') || command.includes('health')) {
                    response = "I can show you nearby hospitals in the Hospitals section. The closest one is AIIMS Hospital, about 2.5 km away.";
                } else if (command.includes('health tip') || command.includes('recommendation')) {
                    response = "Based on current air quality, I recommend wearing an N95 mask outdoors, using air purifiers indoors, and limiting strenuous activities.";
                }
                
                return {
                    success: true,
                    response: response
                };
            }
            
            /**
             * Mock chatbot response
             * @param {string} message - User message
             * @param {string} language - Language code
             * @returns {Object} - Chatbot response
             */
            static async processChatbotMessage(message, language = 'en') {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const msg = message.toLowerCase();
                let response = "I'm sorry, I didn't understand that. How can I help you with air quality information?";
                
                if (msg.includes('complaint') || msg.includes('report')) {
                    response = "You can submit a pollution complaint through the 'Submit Complaint' section. Make sure to include photos and location details for faster resolution.";
                } else if (msg.includes('track') || msg.includes('status')) {
                    response = "You can check your complaint status in the 'Complaint Tracking' section. You'll see updates on pending, in-progress, and resolved complaints.";
                } else if (msg.includes('hospital') || msg.includes('doctor')) {
                    response = "I can show you nearby hospitals in the 'Nearby Hospitals' section. For respiratory issues, I recommend AIIMS or Safdarjung Hospital.";
                } else if (msg.includes('health') || msg.includes('exercise')) {
                    response = "Check the 'Health & Breathing' section for personalized recommendations and guided breathing exercises based on current air quality.";
                } else if (msg.includes('aqi') || msg.includes('air quality')) {
                    response = `Current AQI in Delhi is ${MOCK_DASHBOARD_DATA.data.aqi} (Poor). Sensitive groups should reduce outdoor activities. Check the dashboard for detailed information.`;
                } else if (msg.includes('policy') || msg.includes('government')) {
                    response = "You can rate current policies in the 'Policy Rating' section. Your feedback helps improve environmental policies.";
                } else if (msg.includes('helpline') || msg.includes('emergency')) {
                    response = "For pollution emergencies, contact DPCC at 011-2386 0182. For health emergencies, call 102 or visit the nearest hospital.";
                } else if (msg.includes('department') || msg.includes('resolve')) {
                    response = "Complaints are assigned to relevant departments: Industrial pollution to DPCC, vehicle emissions to Transport Dept, waste burning to Environment Dept.";
                }
                
                return {
                    success: true,
                    response: response
                };
            }
        }
        
        // ===== AUTHENTICATION MANAGEMENT =====
        
        class AuthManager {
            /**
             * Login user
             * @param {string} username - Username
             * @param {string} password - Password
             * @param {string} role - User role
             * @returns {Object} - Login result
             */
            static async login(username, password, role = 'citizen') {
                try {
                    const result = await MockApiService.login(username, password, role);
                    
                    if (result.success) {
                        currentUser = result.user;
                        authToken = result.access_token;
                        
                        // Store in localStorage for persistence
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        localStorage.setItem('authToken', authToken);
                        localStorage.setItem('userRole', role);
                        
                        return { success: true, user: currentUser };
                    } else {
                        return { success: false, error: result.detail || 'Login failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            /**
             * Register new user
             * @param {Object} userData - User data
             * @returns {Object} - Registration result
             */
            static async register(userData) {
                try {
                    const result = await MockApiService.register(userData);
                    
                    if (result.success) {
                        currentUser = result.user;
                        authToken = result.access_token;
                        
                        // Store in localStorage
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        localStorage.setItem('authToken', authToken);
                        localStorage.setItem('userRole', 'citizen');
                        
                        return { success: true, user: currentUser };
                    } else {
                        return { success: false, error: result.detail || 'Registration failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            /**
             * Logout user
             */
            static logout() {
                currentUser = null;
                authToken = null;
                localStorage.removeItem('currentUser');
                localStorage.removeItem('authToken');
                localStorage.removeItem('userRole');
                
                // Clear refresh interval
                if (dashboardRefreshInterval) {
                    clearInterval(dashboardRefreshInterval);
                }
                
                // Clear breathing exercise
                if (breathingExerciseInterval) {
                    clearInterval(breathingExerciseInterval);
                }
                
                // Show auth section, hide dashboard
                document.getElementById('dashboard-section').style.display = 'none';
                document.getElementById('auth-section').style.display = 'block';
                document.getElementById('loginForm').reset();
                switchAuthTab('login');
                
                showAlert('You have been logged out successfully', 'info');
            }
            
            /**
             * Check for stored authentication
             * @returns {boolean} - True if user is authenticated
             */
            static checkStoredAuth() {
                const storedUser = localStorage.getItem('currentUser');
                const storedToken = localStorage.getItem('authToken');
                const storedRole = localStorage.getItem('userRole');
                
                if (storedUser && storedToken && storedRole) {
                    currentUser = JSON.parse(storedUser);
                    authToken = storedToken;
                    return true;
                }
                return false;
            }
        }
        
        // ===== DASHBOARD MANAGEMENT =====
        
        class DashboardManager {
            static charts = {};
            
            /**
             * Load and update dashboard data
             */
            static async loadDashboardData() {
                try {
                    const data = await MockApiService.getDashboardData();
                    
                    if (data.success) {
                        this.updateAQIDisplay(data);
                        this.updateWeatherInfo(data.weather);
                        this.updatePollutantLevels(data.data);
                        this.updateSourceAttribution(data.source_attribution);
                        this.updateHealthRecommendations(data.health_recommendations, data.activity_suggestions);
                        this.updateForecastChart(data.forecast);
                        this.updateUserPoints(data.user_points);
                        
                        document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                    }
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    showAlert('Failed to load dashboard data. Please try again.', 'error');
                }
            }
            
            /**
             * Update AQI display with current data
             * @param {Object} data - Dashboard data
             */
            static updateAQIDisplay(data) {
                const aqi = data.data.aqi;
                const category = this.getAQICategory(aqi);
                const description = data.data.healthMessage || 'Air quality data loaded successfully';
                
                // Update AQI value
                document.getElementById('mainAQI').textContent = aqi;
                document.getElementById('mainAQICategory').textContent = category;
                document.getElementById('mainAQICategory').className = `badge fs-5 px-4 py-2 mb-4 ${this.getAQIClass(aqi)}`;
                document.getElementById('aqiDescription').textContent = description;
                document.getElementById('dominantPollutant').textContent = `Dominant Pollutant: ${data.data.dominantPollutant || 'PM2.5'}`;
                
                // Update progress bar
                const progress = Math.min((aqi / 500) * 100, 100);
                const progressBar = document.getElementById('aqiProgress');
                progressBar.style.width = `${progress}%`;
                progressBar.className = `progress-bar ${this.getAQIClass(aqi)}`;
                
                // Show/hide health alert
                this.toggleHealthAlert(aqi);
            }
            
            /**
             * Get AQI category based on value
             * @param {number} aqi - AQI value
             * @returns {string} - AQI category
             */
            static getAQICategory(aqi) {
                if (aqi <= 50) return 'Good';
                if (aqi <= 100) return 'Satisfactory';
                if (aqi <= 200) return 'Moderate';
                if (aqi <= 300) return 'Poor';
                if (aqi <= 400) return 'Very Poor';
                return 'Severe';
            }
            
            /**
             * Get CSS class for AQI value
             * @param {number} aqi - AQI value
             * @returns {string} - CSS class name
             */
            static getAQIClass(aqi) {
                if (aqi <= 50) return 'aqi-good';
                if (aqi <= 100) return 'aqi-satisfactory';
                if (aqi <= 200) return 'aqi-moderate';
                if (aqi <= 300) return 'aqi-poor';
                if (aqi <= 400) return 'aqi-very-poor';
                return 'aqi-severe';
            }
            
            /**
             * Toggle health alert based on AQI
             * @param {number} aqi - AQI value
             */
            static toggleHealthAlert(aqi) {
                const alertElement = document.getElementById('healthAlert');
                const alertTitle = document.getElementById('alertTitle');
                const alertMessage = document.getElementById('alertMessage');
                
                if (aqi > 200) {
                    let title = 'Health Alert';
                    let message = 'Current air quality may affect sensitive individuals. Limit outdoor activities.';
                    
                    if (aqi > 300) {
                        title = 'High Health Alert';
                        message = 'Air quality is poor. Everyone may begin to experience health effects. Avoid outdoor activities.';
                    }
                    
                    if (aqi > 400) {
                        title = 'Severe Health Alert';
                        message = 'Health emergency! Avoid all outdoor activities. Sensitive groups should take extra precautions.';
                    }
                    
                    alertTitle.textContent = title;
                    alertMessage.textContent = message;
                    alertElement.style.display = 'block';
                } else {
                    alertElement.style.display = 'none';
                }
            }
            
            /**
             * Update weather information
             * @param {Object} weatherData - Weather data
             */
            static updateWeatherInfo(weatherData) {
                document.getElementById('temperature').textContent = `${weatherData.temperature}C`;
                document.getElementById('humidity').textContent = `${weatherData.humidity}%`;
                document.getElementById('windSpeed').textContent = `${weatherData.wind_speed} m/s`;
                document.getElementById('visibility').textContent = `${weatherData.visibility} km`;
            }
            
            /**
             * Update pollutant levels display
             * @param {Object} pollutionData - Pollution data
             */
            static updatePollutantLevels(pollutionData) {
                const pollutants = document.getElementById('pollutantLevels');
                
                const pollutantInfo = [
                    { name: 'PM2.5', value: pollutionData.pm25, unit: 'g/m', max: 250, description: 'Fine particles' },
                    { name: 'PM10', value: pollutionData.pm10, unit: 'g/m', max: 400, description: 'Coarse particles' },
                    { name: 'O', value: pollutionData.o3, unit: 'ppb', max: 200, description: 'Ozone' },
                    { name: 'NO', value: pollutionData.no2, unit: 'ppb', max: 150, description: 'Nitrogen Dioxide' },
                    { name: 'SO', value: pollutionData.so2, unit: 'ppb', max: 100, description: 'Sulfur Dioxide' },
                    { name: 'CO', value: pollutionData.co, unit: 'ppm', max: 10, description: 'Carbon Monoxide' }
                ];
                
                let pollutantsHtml = '';
                
                pollutantInfo.forEach(pollutant => {
                    if (pollutant.value > 0) {
                        const percentage = Math.min((pollutant.value / pollutant.max) * 100, 100);
                        const barColor = percentage < 50 ? 'bg-success' : percentage < 80 ? 'bg-warning' : 'bg-danger';
                        
                        pollutantsHtml += `
                            <div class="col-12 col-sm-6 col-lg-4 mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span><strong>${pollutant.name}</strong></span>
                                    <span class="badge bg-secondary">${pollutant.value} ${pollutant.unit}</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar ${barColor}" style="width: ${percentage}%"></div>
                                </div>
                                <small class="text-muted">${pollutant.description}</small>
                            </div>
                        `;
                    }
                });
                
                pollutants.innerHTML = pollutantsHtml || '<div class="col-12 text-center text-muted">No pollutant data available</div>';
            }
            
            /**
             * Update pollution source attribution
             * @param {Object} sources - Source data
             */
            static updateSourceAttribution(sources) {
                // Update source breakdown
                const sourceBreakdown = document.getElementById('sourceBreakdown');
                let breakdownHtml = '';
                
                for (const [source, percentage] of Object.entries(sources)) {
                    const formattedSource = source.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    breakdownHtml += `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>${formattedSource}</span>
                            <span class="fw-bold">${percentage}%</span>
                        </div>
                        <div class="progress mb-3" style="height: 8px;">
                            <div class="progress-bar" style="width: ${percentage}%"></div>
                        </div>
                    `;
                }
                
                sourceBreakdown.innerHTML = breakdownHtml;
                
                // Update chart
                this.updateSourceChart(sources);
            }
            
            /**
             * Update source chart with new data
             * @param {Object} sources - Source data
             */
            static updateSourceChart(sources) {
                const ctx = document.getElementById('sourceChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (this.charts.sourceChart) {
                    this.charts.sourceChart.destroy();
                }
                
                const labels = Object.keys(sources).map(source => 
                    source.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())
                );
                const data = Object.values(sources);
                const backgroundColors = [
                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                ];
                
                this.charts.sourceChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors,
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }
            
            /**
             * Update health recommendations
             * @param {Array} healthRecs - Health recommendations
             * @param {Array} activityRecs - Activity recommendations
             */
            static updateHealthRecommendations(healthRecs, activityRecs) {
                const healthElement = document.getElementById('healthRecommendations');
                const activityElement = document.getElementById('activitySuggestions');
                
                let healthHtml = '<ul class="mb-0">';
                healthRecs.forEach(rec => {
                    healthHtml += `<li class="mb-2">${rec}</li>`;
                });
                healthHtml += '</ul>';
                
                let activityHtml = '<ul class="mb-0">';
                activityRecs.forEach(rec => {
                    activityHtml += `<li class="mb-2">${rec}</li>`;
                });
                activityHtml += '</ul>';
                
                healthElement.innerHTML = healthHtml;
                activityElement.innerHTML = activityHtml;
            }
            
            /**
             * Update forecast chart
             * @param {Array} forecast - Forecast data
             */
            static updateForecastChart(forecast) {
                const ctx = document.getElementById('forecastChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (this.charts.forecastChart) {
                    this.charts.forecastChart.destroy();
                }
                
                const labels = forecast.map((_, index) => {
                    const date = new Date();
                    date.setHours(date.getHours() + index);
                    return date.getHours() + 'h';
                });
                
                const data = forecast.map(point => point.aqi);
                
                this.charts.forecastChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels.slice(0, 24), // Show first 24 hours
                        datasets: [{
                            label: 'AQI Forecast',
                            data: data.slice(0, 24),
                            borderColor: '#0d6efd',
                            backgroundColor: 'rgba(13, 110, 253, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#0d6efd',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
            }
            
            /**
             * Update user points display
             * @param {number} points - User points
             */
            static updateUserPoints(points) {
                document.getElementById('headerPoints').textContent = `${points} pts`;
                document.getElementById('profilePoints').textContent = `${points} pts`;
            }
        }
        
        // ===== COMPLAINT MANAGEMENT =====
        
        class ComplaintManager {
            /**
             * Initialize complaint form
             */
            static initializeComplaintForm() {
                const complaintForm = document.getElementById('complaintForm');
                const photoUpload = document.getElementById('photoUpload');
                const photoPreview = document.getElementById('photoPreview');
                
                let uploadedPhotos = [];
                
                // Handle photo upload
                photoUpload.addEventListener('change', function(e) {
                    const files = e.target.files;
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            
                            reader.onload = function(e) {
                                const photoId = Date.now() + i;
                                uploadedPhotos.push({
                                    id: photoId,
                                    src: e.target.result
                                });
                                
                                const photoItem = document.createElement('div');
                                photoItem.className = 'photo-preview-item';
                                photoItem.innerHTML = `
                                    <img src="${e.target.result}" alt="Complaint evidence">
                                    <button type="button" class="photo-remove" data-id="${photoId}">
                                        <i class="fas fa-times"></i>
                                    </button>
                                `;
                                
                                photoPreview.appendChild(photoItem);
                                
                                // Add event listener to remove button
                                photoItem.querySelector('.photo-remove').addEventListener('click', function() {
                                    const id = this.getAttribute('data-id');
                                    uploadedPhotos = uploadedPhotos.filter(photo => photo.id != id);
                                    photoItem.remove();
                                });
                            };
                            
                            reader.readAsDataURL(file);
                        }
                    }
                    
                    // Reset file input
                    photoUpload.value = '';
                });
                
                // Handle form submission
                complaintForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        type: document.getElementById('complaintType').value,
                        priority: document.getElementById('priority').value,
                        location: document.getElementById('location').value,
                        description: document.getElementById('description').value,
                        photos: uploadedPhotos
                    };
                    
                    // Validate form
                    if (!formData.type || !formData.priority || !formData.location || !formData.description) {
                        showAlert('Please fill all required fields', 'error');
                        return;
                    }
                    
                    try {
                        const result = await MockApiService.submitComplaint(formData);
                        
                        if (result.success) {
                            showAlert(`Complaint submitted successfully! Your complaint ID is #${result.complaint_id}`, 'success');
                            complaintForm.reset();
                            photoPreview.innerHTML = '';
                            uploadedPhotos = [];
                            
                            // Update user points
                            if (currentUser && currentUser.role === 'citizen') {
                                document.getElementById('headerPoints').textContent = `${currentUser.points} pts`;
                                document.getElementById('profilePoints').textContent = `${currentUser.points} pts`;
                            }
                        } else {
                            showAlert('Failed to submit complaint: ' + result.detail, 'error');
                        }
                    } catch (error) {
                        showAlert('Failed to submit complaint. Please try again.', 'error');
                    }
                });
            }
            
            /**
             * Load user complaints
             */
            static async loadUserComplaints() {
                try {
                    const result = await MockApiService.getUserComplaints();
                    
                    if (result.success) {
                        this.displayComplaints(result.complaints);
                    } else {
                        showAlert('Failed to load complaints: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to load complaints. Please try again.', 'error');
                }
            }
            
            /**
             * Display complaints in the UI
             * @param {Array} complaints - List of complaints
             */
            static displayComplaints(complaints) {
                const complaintsList = document.getElementById('complaintsList');
                
                if (complaints.length === 0) {
                    complaintsList.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-3x mb-3"></i>
                            <p>No complaints submitted yet</p>
                            <a href="#" class="btn btn-primary" onclick="showSection('complaints')">Submit Your First Complaint</a>
                        </div>
                    `;
                    return;
                }
                
                let complaintsHtml = '';
                
                complaints.forEach(complaint => {
                    const statusClass = this.getStatusClass(complaint.status);
                    const priorityClass = this.getPriorityClass(complaint.priority);
                    const typeLabel = this.getTypeLabel(complaint.type);
                    
                    complaintsHtml += `
                        <div class="complaint-item border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h5 class="mb-1">${typeLabel}</h5>
                                    <p class="text-muted mb-1">${complaint.location}</p>
                                    <small class="text-muted">Submitted on ${complaint.date}</small>
                                </div>
                                <div class="text-end">
                                    <span class="status-badge ${statusClass}">${complaint.status.replace('-', ' ')}</span>
                                    <span class="priority-badge ${priorityClass} ms-1">${complaint.priority}</span>
                                </div>
                            </div>
                            <p class="mb-2">${complaint.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">Complaint ID: #${complaint.id}</small>
                                <button class="btn btn-sm btn-outline-primary">View Details</button>
                            </div>
                        </div>
                    `;
                });
                
                complaintsList.innerHTML = complaintsHtml;
            }
            
            /**
             * Load all complaints for department view
             */
            static async loadAllComplaints() {
                try {
                    const result = await MockApiService.getAllComplaints();
                    
                    if (result.success) {
                        this.displayDepartmentComplaints(result.complaints);
                        this.updateDepartmentStats(result.complaints);
                    } else {
                        showAlert('Failed to load complaints: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to load complaints. Please try again.', 'error');
                }
            }
            
            /**
             * Display complaints in department dashboard
             * @param {Array} complaints - List of complaints
             */
            static displayDepartmentComplaints(complaints) {
                const complaintsList = document.getElementById('departmentComplaintsList');
                
                if (complaints.length === 0) {
                    complaintsList.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-3x mb-3"></i>
                            <p>No complaints found</p>
                        </div>
                    `;
                    return;
                }
                
                // Filter complaints for current department
                const departmentComplaints = currentUser ? 
                    complaints.filter(c => c.department === currentUser.username) : 
                    complaints;
                
                if (departmentComplaints.length === 0) {
                    complaintsList.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-3x mb-3"></i>
                            <p>No complaints assigned to your department</p>
                        </div>
                    `;
                    return;
                }
                
                let complaintsHtml = '';
                
                departmentComplaints.slice(0, 5).forEach(complaint => {
                    const statusClass = this.getStatusClass(complaint.status);
                    const priorityClass = this.getPriorityClass(complaint.priority);
                    const typeLabel = this.getTypeLabel(complaint.type);
                    
                    complaintsHtml += `
                        <div class="complaint-item border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h5 class="mb-1">${typeLabel}</h5>
                                    <p class="text-muted mb-1">${complaint.location}</p>
                                    <small class="text-muted">Submitted by ${complaint.citizen} on ${complaint.date}</small>
                                </div>
                                <div class="text-end">
                                    <span class="status-badge ${statusClass}">${complaint.status.replace('-', ' ')}</span>
                                    <span class="priority-badge ${priorityClass} ms-1">${complaint.priority}</span>
                                </div>
                            </div>
                            <p class="mb-2">${complaint.description}</p>
                            <div class="complaint-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="updateComplaintStatus(${complaint.id}, 'in-progress')">In Progress</button>
                                <button class="btn btn-sm btn-outline-success" onclick="updateComplaintStatus(${complaint.id}, 'resolved')">Resolve</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="updateComplaintStatus(${complaint.id}, 'rejected')">Reject</button>
                            </div>
                        </div>
                    `;
                });
                
                complaintsList.innerHTML = complaintsHtml;
            }
            
            /**
             * Load complaints for management table
             */
            static async loadComplaintManagement() {
                try {
                    const result = await MockApiService.getAllComplaints();
                    
                    if (result.success) {
                        this.displayComplaintManagementTable(result.complaints);
                    } else {
                        showAlert('Failed to load complaints: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to load complaints. Please try again.', 'error');
                }
            }
            
            /**
             * Display complaints in management table
             * @param {Array} complaints - List of complaints
             */
            static displayComplaintManagementTable(complaints) {
                const tableBody = document.getElementById('complaintManagementTable');
                
                if (complaints.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="fas fa-inbox fa-3x mb-3"></i>
                                <p>No complaints found</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let tableHtml = '';
                
                complaints.forEach(complaint => {
                    const statusClass = this.getStatusClass(complaint.status);
                    const priorityClass = this.getPriorityClass(complaint.priority);
                    const typeLabel = this.getTypeLabel(complaint.type);
                    
                    tableHtml += `
                        <tr>
                            <td>#${complaint.id}</td>
                            <td>${typeLabel}</td>
                            <td>${complaint.location}</td>
                            <td><span class="priority-badge ${priorityClass}">${complaint.priority}</span></td>
                            <td><span class="status-badge ${statusClass}">${complaint.status.replace('-', ' ')}</span></td>
                            <td>${complaint.date}</td>
                            <td>
                                <div class="complaint-actions">
                                    <select class="form-select form-select-sm" onchange="updateComplaintStatus(${complaint.id}, this.value)" style="width: 150px;">
                                        <option value="pending" ${complaint.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="in-progress" ${complaint.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                        <option value="resolved" ${complaint.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                                        <option value="rejected" ${complaint.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                                    </select>
                                    <button class="btn btn-sm btn-outline-primary" onclick="assignComplaintDepartment(${complaint.id})">Assign Dept</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = tableHtml;
            }
            
            /**
             * Update department statistics
             * @param {Array} complaints - List of complaints
             */
            static updateDepartmentStats(complaints) {
                // Filter complaints for current department
                const departmentComplaints = currentUser ? 
                    complaints.filter(c => c.department === currentUser.username) : 
                    complaints;
                
                const total = departmentComplaints.length;
                const pending = departmentComplaints.filter(c => c.status === 'pending').length;
                const inProgress = departmentComplaints.filter(c => c.status === 'in-progress').length;
                const resolved = departmentComplaints.filter(c => c.status === 'resolved').length;
                
                document.getElementById('total-complaints').textContent = total;
                document.getElementById('pending-complaints').textContent = pending;
                document.getElementById('inprogress-complaints').textContent = inProgress;
                document.getElementById('resolved-complaints').textContent = resolved;
            }
            
            /**
             * Get CSS class for complaint status
             * @param {string} status - Complaint status
             * @returns {string} - CSS class name
             */
            static getStatusClass(status) {
                const statusClasses = {
                    'pending': 'status-pending',
                    'in-progress': 'status-in-progress',
                    'under-investigation': 'status-under-investigation',
                    'resolved': 'status-resolved',
                    'rejected': 'status-rejected'
                };
                
                return statusClasses[status] || 'status-pending';
            }
            
            /**
             * Get CSS class for complaint priority
             * @param {string} priority - Complaint priority
             * @returns {string} - CSS class name
             */
            static getPriorityClass(priority) {
                const priorityClasses = {
                    'low': 'priority-low',
                    'medium': 'priority-medium',
                    'high': 'priority-high',
                    'critical': 'priority-critical'
                };
                
                return priorityClasses[priority] || 'priority-medium';
            }
            
            /**
             * Get display label for complaint type
             * @param {string} type - Complaint type
             * @returns {string} - Display label
             */
            static getTypeLabel(type) {
                const typeLabels = {
                    'industrial_pollution': 'Industrial Pollution',
                    'vehicle_emission': 'Vehicle Emission',
                    'construction_dust': 'Construction Dust',
                    'waste_burning': 'Waste Burning',
                    'other': 'Other'
                };
                
                return typeLabels[type] || type;
            }
        }
        
        // ===== POLICY RATING MANAGEMENT =====
        
        class PolicyRatingManager {
            /**
             * Initialize policy rating functionality
             */
            static initializePolicyRating() {
                // Set up star rating interaction
                document.querySelectorAll('.rating-stars').forEach(stars => {
                    stars.querySelectorAll('.star').forEach(star => {
                        star.addEventListener('mouseover', function() {
                            const rating = parseInt(this.getAttribute('data-rating'));
                            this.parentElement.querySelectorAll('.star').forEach(s => {
                                if (parseInt(s.getAttribute('data-rating')) <= rating) {
                                    s.style.color = '#ffc107';
                                } else {
                                    s.style.color = '#e4e5e9';
                                }
                            });
                        });
                        
                        star.addEventListener('mouseout', function() {
                            this.parentElement.querySelectorAll('.star').forEach(s => {
                                s.style.color = '#e4e5e9';
                            });
                        });
                        
                        star.addEventListener('click', function() {
                            const policy = this.parentElement.getAttribute('data-policy');
                            const rating = parseInt(this.getAttribute('data-rating'));
                            
                            // Store rating temporarily
                            this.parentElement.setAttribute('data-current-rating', rating);
                            
                            // Update star colors
                            this.parentElement.querySelectorAll('.star').forEach(s => {
                                if (parseInt(s.getAttribute('data-rating')) <= rating) {
                                    s.style.color = '#ffc107';
                                } else {
                                    s.style.color = '#e4e5e9';
                                }
                            });
                            
                            // Update rating text
                            document.getElementById(`${policy}-rating-text`).textContent = `Rated ${rating} out of 5`;
                        });
                    });
                });
            }
            
            /**
             * Submit policy rating
             * @param {string} policy - Policy name
             */
            static async submitPolicyRating(policy) {
                const stars = document.querySelector(`.rating-stars[data-policy="${policy}"]`);
                const rating = stars.getAttribute('data-current-rating');
                const feedback = document.getElementById(`${policy}-feedback`).value;
                
                if (!rating) {
                    showAlert('Please select a rating before submitting', 'error');
                    return;
                }
                
                try {
                    const result = await MockApiService.submitPolicyRating(policy, parseInt(rating), feedback);
                    
                    if (result.success) {
                        showAlert('Policy rating submitted successfully!', 'success');
                        document.getElementById(`${policy}-feedback`).value = '';
                        
                        // Update user points
                        if (currentUser && currentUser.role === 'citizen') {
                            document.getElementById('headerPoints').textContent = `${currentUser.points} pts`;
                            document.getElementById('profilePoints').textContent = `${currentUser.points} pts`;
                        }
                    } else {
                        showAlert('Failed to submit rating: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to submit rating. Please try again.', 'error');
                }
            }
            
            /**
             * Load policy ratings for policymaker view
             */
            static async loadPolicyRatings() {
                try {
                    const result = await MockApiService.getPolicyRatings();
                    
                    if (result.success) {
                        this.displayPolicyRatings(result.ratings);
                        this.createPolicyChart(result.ratings);
                        this.createSentimentChart(result.ratings);
                    } else {
                        showAlert('Failed to load policy ratings: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to load policy ratings. Please try again.', 'error');
                }
            }
            
            /**
             * Display policy ratings
             * @param {Array} ratings - Policy ratings data
             */
            static displayPolicyRatings(ratings) {
                const ratingsList = document.getElementById('policyRatingsList');
                
                let ratingsHtml = '';
                
                ratings.forEach(policy => {
                    const avgRating = policy.ratings.reduce((a, b) => a + b, 0) / policy.ratings.length;
                    const policyName = this.getPolicyName(policy.policy);
                    
                    ratingsHtml += `
                        <div class="policy-rating-item border-bottom pb-3 mb-3">
                            <h6>${policyName}</h6>
                            <div class="d-flex align-items-center mb-2">
                                <div class="rating-stars me-2">
                                    ${this.generateStars(avgRating)}
                                </div>
                                <span class="fw-bold">${avgRating.toFixed(1)}/5</span>
                            </div>
                            <p class="small text-muted mb-1">Based on ${policy.ratings.length} ratings</p>
                            <div class="feedback-preview">
                                <p class="small mb-1"><strong>Recent feedback:</strong></p>
                                <p class="small text-muted">"${policy.feedback[policy.feedback.length - 1]}"</p>
                            </div>
                        </div>
                    `;
                });
                
                ratingsList.innerHTML = ratingsHtml;
            }
            
            /**
             * Create policy chart
             * @param {Array} ratings - Policy ratings data
             */
            static createPolicyChart(ratings) {
                const ctx = document.getElementById('policyChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (window.policyChart) {
                    window.policyChart.destroy();
                }
                
                const labels = ratings.map(p => this.getPolicyName(p.policy));
                const data = ratings.map(p => p.ratings.reduce((a, b) => a + b, 0) / p.ratings.length);
                
                window.policyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Average Rating',
                            data: data,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            /**
             * Create sentiment chart
             * @param {Array} ratings - Policy ratings data
             */
            static createSentimentChart(ratings) {
                const ctx = document.getElementById('sentimentChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (window.sentimentChart) {
                    window.sentimentChart.destroy();
                }
                
                const labels = ratings.map(p => this.getPolicyName(p.policy));
                const positive = ratings.map(p => p.ratings.filter(r => r >= 4).length);
                const neutral = ratings.map(p => p.ratings.filter(r => r === 3).length);
                const negative = ratings.map(p => p.ratings.filter(r => r <= 2).length);
                
                window.sentimentChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Positive (4-5 stars)',
                                data: positive,
                                backgroundColor: 'rgba(40, 167, 69, 0.7)'
                            },
                            {
                                label: 'Neutral (3 stars)',
                                data: neutral,
                                backgroundColor: 'rgba(255, 193, 7, 0.7)'
                            },
                            {
                                label: 'Negative (1-2 stars)',
                                data: negative,
                                backgroundColor: 'rgba(220, 53, 69, 0.7)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                stacked: true,
                            },
                            y: {
                                stacked: true
                            }
                        }
                    }
                });
            }
            
            /**
             * Get policy display name
             * @param {string} policy - Policy code
             * @returns {string} - Policy display name
             */
            static getPolicyName(policy) {
                const policyNames = {
                    'odd-even': 'Odd-Even Policy',
                    'grap': 'GRAP Implementation',
                    'ev': 'EV Promotion'
                };
                
                return policyNames[policy] || policy;
            }
            
            /**
             * Generate star HTML based on rating
             * @param {number} rating - Rating value
             * @returns {string} - Star HTML
             */
            static generateStars(rating) {
                let stars = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                
                for (let i = 0; i < fullStars; i++) {
                    stars += '<span class="star" style="color: #ffc107;"></span>';
                }
                
                if (hasHalfStar) {
                    stars += '<span class="star" style="color: #ffc107;"></span>';
                }
                
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                for (let i = 0; i < emptyStars; i++) {
                    stars += '<span class="star" style="color: #e4e5e9;"></span>';
                }
                
                return stars;
            }
        }
        
        // ===== DEPARTMENT REPORT MANAGEMENT =====
        
        class DepartmentReportManager {
            /**
             * Load department reports
             */
            static async loadDepartmentReports() {
                this.createDepartmentChart();
            }
            
            /**
             * Create department performance chart
             */
            static createDepartmentChart() {
                const ctx = document.getElementById('departmentChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (window.departmentChart) {
                    window.departmentChart.destroy();
                }
                
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const complaintsReceived = [45, 52, 48, 60, 55, 58, 62, 65, 70, 68, 72, 75];
                const complaintsResolved = [38, 45, 42, 52, 48, 50, 55, 58, 62, 60, 65, 68];
                
                window.departmentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Complaints Received',
                                data: complaintsReceived,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Complaints Resolved',
                                data: complaintsResolved,
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }
        
        // ===== POLICYMAKER DASHBOARD MANAGEMENT =====
        
        class PolicymakerDashboardManager {
            /**
             * Load policymaker dashboard
             */
            static async loadPolicymakerDashboard() {
                this.createDemographicsChart();
            }
            
            /**
             * Create demographics chart
             */
            static createDemographicsChart() {
                const ctx = document.getElementById('demographicsChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (window.demographicsChart) {
                    window.demographicsChart.destroy();
                }
                
                window.demographicsChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['18-30 years', '31-45 years', '46-60 years', '60+ years'],
                        datasets: [{
                            data: [35, 40, 18, 7],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }
        
        // ===== CHATBOT MANAGEMENT =====
        
        class ChatbotManager {
            /**
             * Initialize chatbot
             */
            static initializeChatbot() {
                const sendButton = document.getElementById('sendChatbotMessage');
                const input = document.getElementById('chatbotInput');
                
                // Send message on button click
                sendButton.addEventListener('click', () => {
                    this.sendMessage();
                });
                
                // Send message on Enter key
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });
            }
            
            /**
             * Send chatbot message
             */
            static async sendMessage() {
                const input = document.getElementById('chatbotInput');
                const message = input.value.trim();
                const language = document.getElementById('chatbotLanguage').value;
                
                if (!message) return;
                
                // Add user message to chat
                this.addMessage(message, 'user');
                input.value = '';
                
                // Get bot response
                try {
                    const response = await MockApiService.processChatbotMessage(message, language);
                    
                    if (response.success) {
                        this.addMessage(response.response, 'bot');
                    } else {
                        this.addMessage("I'm sorry, I'm having trouble processing your request. Please try again.", 'bot');
                    }
                } catch (error) {
                    this.addMessage("I'm sorry, I'm experiencing technical difficulties. Please try again later.", 'bot');
                }
            }
            
            /**
             * Add message to chatbot
             * @param {string} message - Message text
             * @param {string} sender - 'user' or 'bot'
             */
            static addMessage(message, sender) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageElement = document.createElement('div');
                messageElement.className = `message ${sender}-message`;
                messageElement.textContent = message;
                
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }
        
        // ===== TRANSLATION MANAGEMENT =====
        
        class TranslationManager {
            /**
             * Initialize translation functionality
             */
            static initializeTranslation() {
                // This is a mock implementation
                // In a real app, this would integrate with Google Translate API
                console.log('Translation initialized');
            }
            
            /**
             * Apply translation to page
             * @param {string} language - Language code
             */
            static async applyTranslation(language) {
                // This is a mock implementation
                // In a real app, this would translate the page content
                
                showAlert(`Page translation to ${this.getLanguageName(language)} applied successfully. This is a demo - in a real app, the entire page would be translated.`, 'info');
                
                // Close translation panel
                toggleTranslationPanel();
            }
            
            /**
             * Get language name from code
             * @param {string} code - Language code
             * @returns {string} - Language name
             */
            static getLanguageName(code) {
                const languages = {
                    'en': 'English',
                    'hi': 'Hindi',
                    'bn': 'Bengali',
                    'ta': 'Tamil',
                    'te': 'Telugu',
                    'mr': 'Marathi',
                    'gu': 'Gujarati',
                    'kn': 'Kannada',
                    'ml': 'Malayalam',
                    'pa': 'Punjabi'
                };
                
                return languages[code] || code;
            }
        }
        
        // ===== NEW FEATURES MANAGEMENT =====
        
        class AQISheltersManager {
            /**
             * Load AQI shelters data
             */
            static async loadAQIShelters() {
                // This would load data from API in a real implementation
                console.log('Loading AQI shelters data');
            }
        }
        
        class InsuranceManager {
            /**
             * Load insurance plans
             */
            static async loadInsurancePlans() {
                // This would load data from API in a real implementation
                console.log('Loading insurance plans');
            }
        }
        
        class EventsManager {
            /**
             * Load events data
             */
            static async loadEvents() {
                // This would load data from API in a real implementation
                console.log('Loading events data');
            }
        }
        
        // ===== EXISTING MANAGERS (Map, Hospital, Health, Profile) =====
        // These classes would be implemented similarly to the ones above
        // For brevity, we'll include placeholder implementations
        
        class MapManager {
            static initializeAQIMap() {
                // Initialize Leaflet map
                console.log('Initializing AQI map');
            }
        }
        
        class HospitalManager {
            static async loadNearbyHospitals() {
                try {
                    const result = await MockApiService.getNearbyHospitals();
                    
                    if (result.success) {
                        this.displayHospitals(result.hospitals);
                    } else {
                        showAlert('Failed to load hospitals: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to load hospitals. Please try again.', 'error');
                }
            }
            
            static displayHospitals(hospitals) {
                const hospitalsList = document.getElementById('hospitalsList');
                
                if (hospitals.length === 0) {
                    hospitalsList.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-hospital fa-3x mb-3"></i>
                            <p>No hospitals found in your area</p>
                        </div>
                    `;
                    return;
                }
                
                let hospitalsHtml = '';
                
                hospitals.forEach(hospital => {
                    hospitalsHtml += `
                        <div class="hospital-item border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h5 class="mb-1">${hospital.name}</h5>
                                    <p class="text-muted mb-1">${hospital.address}</p>
                                    <p class="mb-1"><i class="fas fa-phone me-1"></i> ${hospital.phone}</p>
                                    <p class="mb-0"><i class="fas fa-map-marker-alt me-1"></i> ${hospital.distance} away</p>
                                </div>
                                <div>
                                    <span class="badge bg-primary">${hospital.specialties[0]}</span>
                                </div>
                            </div>
                            <div class="specialties">
                                <small class="text-muted">Specialties: ${hospital.specialties.join(', ')}</small>
                            </div>
                        </div>
                    `;
                });
                
                hospitalsList.innerHTML = hospitalsHtml;
            }
        }
        
        class HealthManager {
            static loadHealthData() {
                // Initialize health assessment form
                const healthForm = document.getElementById('healthForm');
                
                healthForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const age = document.getElementById('age').value;
                    const respiratoryCondition = document.querySelector('input[name="respiratoryCondition"]:checked').value;
                    const smoking = document.querySelector('input[name="smoking"]:checked').value;
                    const activityLevel = document.getElementById('activityLevel').value;
                    
                    // Generate personalized recommendations
                    const recommendations = HealthManager.generateHealthRecommendations(
                        age, respiratoryCondition, smoking, activityLevel
                    );
                    
                    document.getElementById('personalHealthRecommendations').innerHTML = recommendations;
                    
                    showAlert('Health assessment completed! Personalized recommendations generated.', 'success');
                });
                
                // Initialize breathing exercise
                const startBreathingBtn = document.getElementById('startBreathing');
                let breathingActive = false;
                
                startBreathingBtn.addEventListener('click', function() {
                    if (!breathingActive) {
                        HealthManager.startBreathingExercise();
                        startBreathingBtn.innerHTML = '<i class="fas fa-stop me-2"></i>Stop Exercise';
                        breathingActive = true;
                    } else {
                        HealthManager.stopBreathingExercise();
                        startBreathingBtn.innerHTML = '<i class="fas fa-play me-2"></i>Start Exercise';
                        breathingActive = false;
                    }
                });
            }
            
            static generateHealthRecommendations(age, respiratoryCondition, smoking, activityLevel) {
                let recommendations = '<h5>Personalized Health Recommendations</h5><ul>';
                
                // Age-based recommendations
                if (age < 18) {
                    recommendations += '<li>Children are more vulnerable to air pollution. Limit outdoor activities during high AQI days.</li>';
                } else if (age > 60) {
                    recommendations += '<li>Older adults should take extra precautions. Consider using air purifiers at home.</li>';
                }
                
                // Respiratory condition recommendations
                if (respiratoryCondition === 'yes') {
                    recommendations += '<li>If you have respiratory conditions, always carry your inhaler or medication when going outside.</li>';
                    recommendations += '<li>Consider consulting your doctor for personalized advice during high pollution periods.</li>';
                }
                
                // Smoking recommendations
                if (smoking === 'yes') {
                    recommendations += '<li>Smoking combined with air pollution significantly increases health risks. Consider quitting or reducing smoking.</li>';
                }
                
                // Activity level recommendations
                if (activityLevel === 'very' || activityLevel === 'moderate') {
                    recommendations += '<li>If you are very active, schedule outdoor exercises during times when AQI is lower (usually afternoon).</li>';
                    recommendations += '<li>Consider indoor exercise alternatives on high pollution days.</li>';
                }
                
                // General recommendations
                recommendations += '<li>Monitor AQI levels regularly and plan activities accordingly.</li>';
                recommendations += '<li>Use N95 masks when AQI exceeds 200 (Poor).</li>';
                recommendations += '<li>Keep windows closed during high pollution periods and use air purifiers.</li>';
                recommendations += '<li>Stay hydrated to help your body flush out pollutants.</li>';
                
                recommendations += '</ul>';
                
                return recommendations;
            }
            
            static startBreathingExercise() {
                const circle = document.getElementById('breathingCircle');
                const instruction = document.getElementById('breathingInstruction');
                const timer = document.getElementById('breathingTimer');
                
                let phase = 0; // 0: inhale, 1: hold, 2: exhale, 3: hold
                let count = 4;
                
                breathingExerciseInterval = setInterval(() => {
                    switch(phase) {
                        case 0: // Inhale
                            instruction.textContent = 'Breathe in through your nose';
                            timer.textContent = `Hold for ${count} seconds`;
                            circle.style.transform = 'scale(1.2)';
                            circle.textContent = 'Breathe In';
                            break;
                        case 1: // Hold after inhale
                            instruction.textContent = 'Hold your breath';
                            timer.textContent = `Exhale for ${count} seconds`;
                            circle.textContent = 'Hold';
                            break;
                        case 2: // Exhale
                            instruction.textContent = 'Breathe out through your mouth';
                            timer.textContent = `Hold for ${count} seconds`;
                            circle.style.transform = 'scale(1)';
                            circle.textContent = 'Breathe Out';
                            break;
                        case 3: // Hold after exhale
                            instruction.textContent = 'Hold your breath';
                            timer.textContent = `Inhale for ${count} seconds`;
                            circle.textContent = 'Hold';
                            break;
                    }
                    
                    count--;
                    
                    if (count < 0) {
                        phase = (phase + 1) % 4;
                        count = 4;
                    }
                }, 1000);
            }
            
            static stopBreathingExercise() {
                if (breathingExerciseInterval) {
                    clearInterval(breathingExerciseInterval);
                    
                    const circle = document.getElementById('breathingCircle');
                    const instruction = document.getElementById('breathingInstruction');
                    const timer = document.getElementById('breathingTimer');
                    
                    circle.style.transform = 'scale(1)';
                    circle.textContent = 'Breathe In';
                    instruction.textContent = 'Breathe in through your nose';
                    timer.textContent = 'Hold for 4 seconds';
                }
            }
        }
        
        class ProfileManager {
            static loadProfileData() {
                // Load user data into profile form
                if (currentUser) {
                    document.getElementById('profileFullName').value = currentUser.full_name || currentUser.name || '';
                    document.getElementById('profileEmail').value = currentUser.email || '';
                    document.getElementById('profileMobile').value = currentUser.mobile || '';
                    document.getElementById('profileLocation').value = currentUser.location || 'Delhi, India';
                }
                
                // Handle profile form submission
                const profileForm = document.getElementById('profileForm');
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Update user data
                    if (currentUser) {
                        currentUser.full_name = document.getElementById('profileFullName').value;
                        currentUser.email = document.getElementById('profileEmail').value;
                        currentUser.mobile = document.getElementById('profileMobile').value;
                        currentUser.location = document.getElementById('profileLocation').value;
                        
                        // Update localStorage
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        showAlert('Profile updated successfully!', 'success');
                    }
                });
                
                // Handle password form submission
                const passwordForm = document.getElementById('passwordForm');
                passwordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    if (newPassword !== confirmPassword) {
                        showAlert('New passwords do not match', 'error');
                        return;
                    }
                    
                    if (newPassword.length < 6) {
                        showAlert('New password must be at least 6 characters long', 'error');
                        return;
                    }
                    
                    // In a real app, this would verify current password with the server
                    showAlert('Password changed successfully!', 'success');
                    passwordForm.reset();
                });
                
                // Handle account deletion
                const deleteAccountBtn = document.getElementById('deleteAccount');
                deleteAccountBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                        AuthManager.logout();
                        showAlert('Your account has been deleted successfully.', 'info');
                    }
                });
            }
        }
        
        class NotificationManager {
            static async loadNotifications() {
                try {
                    const result = await MockApiService.getNotifications();
                    
                    if (result.success) {
                        this.displayNotifications(result.notifications);
                    }
                } catch (error) {
                    console.error('Error loading notifications:', error);
                }
            }
            
            static displayNotifications(notifications) {
                const notificationPanel = document.getElementById('notificationPanelContent');
                const notificationCount = document.getElementById('notificationCount');
                
                if (notifications.length === 0) {
                    notificationPanel.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <p>No new notifications</p>
                        </div>
                    `;
                    notificationCount.textContent = '0';
                    return;
                }
                
                let unreadCount = notifications.filter(n => !n.read).length;
                notificationCount.textContent = unreadCount;
                
                let notificationsHtml = '';
                
                notifications.forEach(notification => {
                    const notificationClass = notification.read ? '' : 'fw-bold';
                    
                    notificationsHtml += `
                        <div class="notification-item ${notificationClass}" data-id="${notification.id}">
                            <h6 class="mb-1">${notification.title}</h6>
                            <p class="mb-1">${notification.message}</p>
                            <small class="text-muted">${notification.time}</small>
                        </div>
                    `;
                });
                
                notificationPanel.innerHTML = notificationsHtml;
                
                // Add click event to mark as read
                notificationPanel.querySelectorAll('.notification-item').forEach(item => {
                    item.addEventListener('click', function() {
                        this.classList.remove('fw-bold');
                        const id = this.getAttribute('data-id');
                        
                        // Update unread count
                        unreadCount = Math.max(0, unreadCount - 1);
                        notificationCount.textContent = unreadCount;
                    });
                });
            }
        }
        
        class VoiceAssistant {
            constructor() {
                this.listening = false;
                this.recognition = null;
            }
            
            startListening() {
                const voiceStatus = document.getElementById('voiceStatus');
                
                // Check if browser supports speech recognition
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    voiceStatus.textContent = 'Speech recognition not supported in this browser';
                    return;
                }
                
                // Create speech recognition object
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.lang = 'en-US';
                
                this.recognition.onstart = () => {
                    this.listening = true;
                    voiceStatus.textContent = 'Listening... Speak now';
                    voiceStatus.classList.add('listening');
                };
                
                this.recognition.onresult = async (event) => {
                    const transcript = event.results[0][0].transcript;
                    voiceStatus.textContent = `Heard: "${transcript}"`;
                    
                    // Process the command
                    try {
                        const response = await MockApiService.processVoiceCommand({
                            command: transcript
                        });
                        
                        if (response.success) {
                            // Speak the response
                            this.speak(response.response);
                            voiceStatus.textContent = `Response: ${response.response}`;
                        }
                    } catch (error) {
                        console.error('Error processing voice command:', error);
                        voiceStatus.textContent = 'Error processing command. Please try again.';
                    }
                };
                
                this.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    voiceStatus.textContent = `Error: ${event.error}`;
                    this.listening = false;
                    voiceStatus.classList.remove('listening');
                };
                
                this.recognition.onend = () => {
                    this.listening = false;
                    voiceStatus.classList.remove('listening');
                    
                    if (voiceStatus.textContent === 'Listening... Speak now') {
                        voiceStatus.textContent = 'No speech detected. Please try again.';
                    }
                };
                
                this.recognition.start();
            }
            
            stopListening() {
                if (this.recognition && this.listening) {
                    this.recognition.stop();
                    this.listening = false;
                    
                    const voiceStatus = document.getElementById('voiceStatus');
                    voiceStatus.textContent = 'Click microphone to start';
                    voiceStatus.classList.remove('listening');
                }
            }
            
            speak(text) {
                // Check if browser supports speech synthesis
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    window.speechSynthesis.speak(utterance);
                }
            }
        }
        
        // ===== INITIALIZATION FUNCTIONS =====
        
        /**
         * Initialize the application
         */
        function initializeApp() {
            // Hide global loader after a short delay
            setTimeout(() => {
                document.getElementById('globalLoader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('globalLoader').style.display = 'none';
                }, 500);
            }, 1500);
            
            // Check for stored authentication
            if (AuthManager.checkStoredAuth()) {
                showDashboard();
            }
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize chatbot
            ChatbotManager.initializeChatbot();
            
            // Initialize translation
            TranslationManager.initializeTranslation();
        }
        
        /**
         * Setup all event listeners
         */
        function setupEventListeners() {
            // Authentication
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registrationForm').addEventListener('submit', handleRegister);
            document.getElementById('departmentLoginForm').addEventListener('submit', handleDepartmentLogin);
            document.getElementById('policymakerLoginForm').addEventListener('submit', handlePolicymakerLogin);
            document.getElementById('login-tab').addEventListener('click', () => switchAuthTab('login'));
            document.getElementById('register-tab').addEventListener('click', () => switchAuthTab('register'));
            document.getElementById('department-tab').addEventListener('click', () => switchAuthTab('department'));
            document.getElementById('policymaker-tab').addEventListener('click', () => switchAuthTab('policymaker'));
            
            // Navigation
            document.getElementById('menuToggle').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleSidebar);
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.addEventListener('click', handleSidebarNavigation);
            });
            
            // Header buttons
            document.getElementById('translateBtn').addEventListener('click', toggleTranslationPanel);
            document.getElementById('chatbotBtn').addEventListener('click', toggleChatbotPanel);
            document.getElementById('closeChatbot').addEventListener('click', toggleChatbotPanel);
            document.getElementById('notificationsBtn').addEventListener('click', toggleNotificationPanel);
            document.getElementById('profileBtn').addEventListener('click', toggleProfilePanel);
            document.getElementById('voiceAssistant').addEventListener('click', toggleVoicePanel);
            document.getElementById('closeVoice').addEventListener('click', toggleVoicePanel);
            document.getElementById('closeTranslation').addEventListener('click', toggleTranslationPanel);
            
            // Translation
            document.getElementById('applyTranslation').addEventListener('click', () => {
                const language = document.getElementById('translationLanguage').value;
                TranslationManager.applyTranslation(language);
            });
            
            // Mark all notifications as read
            document.getElementById('markAllRead').addEventListener('click', function() {
                document.querySelectorAll('.notification-item').forEach(item => {
                    item.classList.remove('fw-bold');
                });
                document.getElementById('notificationCount').textContent = '0';
            });
            
            // AR Experience button
            document.getElementById('startAR').addEventListener('click', function() {
                showAlert('AR experience would start here. In a real app, this would access your camera.', 'info');
            });
            
            // Logout
            document.getElementById('logout-sidebar').addEventListener('click', AuthManager.logout);
            document.getElementById('logout-profile').addEventListener('click', AuthManager.logout);
        }
        
        // ===== EVENT HANDLERS =====
        
        /**
         * Handle login form submission
         * @param {Event} e - Form submission event
         */
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            showLoading('login-spinner');
            
            const result = await AuthManager.login(username, password, 'citizen');
            
            hideLoading('login-spinner');
            
            if (result.success) {
                showDashboard();
                showAlert('Login successful! Welcome back.', 'success');
            } else {
                showAlert('Login failed: ' + result.error, 'error');
            }
        }
        
        /**
         * Handle department login form submission
         * @param {Event} e - Form submission event
         */
        async function handleDepartmentLogin(e) {
            e.preventDefault();
            const username = document.getElementById('departmentUsername').value;
            const password = document.getElementById('departmentPassword').value;
            
            showLoading('department-spinner');
            
            const result = await AuthManager.login(username, password, 'department');
            
            hideLoading('department-spinner');
            
            if (result.success) {
                showDashboard();
                showAlert('Department login successful!', 'success');
            } else {
                showAlert('Login failed: ' + result.error, 'error');
            }
        }
        
        /**
         * Handle policymaker login form submission
         * @param {Event} e - Form submission event
         */
        async function handlePolicymakerLogin(e) {
            e.preventDefault();
            const username = document.getElementById('policymakerUsername').value;
            const password = document.getElementById('policymakerPassword').value;
            
            showLoading('policymaker-spinner');
            
            const result = await AuthManager.login(username, password, 'policymaker');
            
            hideLoading('policymaker-spinner');
            
            if (result.success) {
                showDashboard();
                showAlert('Policymaker login successful!', 'success');
            } else {
                showAlert('Login failed: ' + result.error, 'error');
            }
        }
        
        /**
         * Handle registration form submission
         * @param {Event} e - Form submission event
         */
        async function handleRegister(e) {
            e.preventDefault();
            const formData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                mobile: document.getElementById('mobile').value
            };
            
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPasswordReg').value;
            
            if (password !== confirmPassword) {
                showAlert('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showAlert('Password must be at least 6 characters long', 'error');
                return;
            }
            
            showLoading('register-spinner');
            
            const result = await AuthManager.register(formData);
            
            hideLoading('register-spinner');
            
            if (result.success) {
                showDashboard();
                showAlert('Registration successful! Welcome to AQI NCR.', 'success');
            } else {
                showAlert('Registration failed: ' + result.error, 'error');
            }
        }
        
        /**
         * Handle sidebar navigation
         * @param {Event} e - Click event
         */
        function handleSidebarNavigation(e) {
            e.preventDefault();
            if (e.target.id === 'logout-sidebar') {
                AuthManager.logout();
                return;
            }
            const section = e.target.getAttribute('data-section');
            showSection(section);
            
            // Close sidebar on mobile after selection
            if (window.innerWidth < 768) {
                toggleSidebar();
            }
        }
        
        /**
         * Switch between login and register tabs
         * @param {string} tab - Tab to switch to
         */
        function switchAuthTab(tab) {
            // Reset all tabs
            document.querySelectorAll('.auth-tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelectorAll('.auth-panel').forEach(p => {
                p.style.display = 'none';
            });
            
            // Activate selected tab
            document.getElementById(`${tab}-tab`).classList.add('active');
            document.getElementById(`${tab}-form`).style.display = 'block';
        }
        
        /**
         * Show dashboard and initialize components
         */
        function showDashboard() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'flex';
            
            // Initialize voice assistant
            voiceAssistant = new VoiceAssistant();
            
            // Update profile information
            if (currentUser) {
                document.getElementById('profileUserName').textContent = currentUser.full_name || currentUser.username || currentUser.name;
                document.getElementById('headerPoints').textContent = `${currentUser.points || 0} pts`;
                document.getElementById('profilePoints').textContent = `${currentUser.points || 0} pts`;
                
                // Show/hide menu items based on user role
                updateSidebarForUserRole();
            }
            
            // Load initial data
            loadDashboardData();
            NotificationManager.loadNotifications();
            
            // Start auto-refresh (every 5 minutes)
            dashboardRefreshInterval = setInterval(loadDashboardData, 300000);
        }
        
        /**
         * Update sidebar based on user role
         */
        function updateSidebarForUserRole() {
            const role = currentUser ? currentUser.role : 'citizen';
            
            // Hide all role-specific menus
            document.querySelectorAll('.citizen-menu, .department-menu, .policymaker-menu').forEach(item => {
                item.style.display = 'none';
            });
            
            // Show appropriate menu
            if (role === 'citizen') {
                document.querySelectorAll('.citizen-menu').forEach(item => {
                    item.style.display = 'block';
                });
                showSection('dashboard');
            } else if (role === 'department') {
                document.querySelectorAll('.department-menu').forEach(item => {
                    item.style.display = 'block';
                });
                showSection('department-dashboard');
            } else if (role === 'policymaker') {
                document.querySelectorAll('.policymaker-menu').forEach(item => {
                    item.style.display = 'block';
                });
                showSection('policymaker-dashboard');
            }
        }
        
        /**
         * Start voice recognition
         */
        function startVoiceRecognition() {
            if (voiceAssistant) {
                voiceAssistant.startListening();
            }
        }
        
        /**
         * Stop voice recognition
         */
        function stopVoiceRecognition() {
            if (voiceAssistant) {
                voiceAssistant.stopListening();
            }
        }
        
        /**
         * Update complaint status
         * @param {number} complaintId - Complaint ID
         * @param {string} status - New status
         */
        async function updateComplaintStatus(complaintId, status) {
            try {
                const result = await MockApiService.updateComplaintStatus(complaintId, status);
                
                if (result.success) {
                    showAlert('Complaint status updated successfully', 'success');
                    
                    // Reload the current section
                    const activeSection = document.querySelector('.content-section.active').id;
                    const sectionName = activeSection.replace('-section-content', '');
                    loadSectionData(sectionName);
                } else {
                    showAlert('Failed to update complaint status: ' + result.detail, 'error');
                }
            } catch (error) {
                showAlert('Failed to update complaint status. Please try again.', 'error');
            }
        }
        
        /**
         * Assign complaint to department
         * @param {number} complaintId - Complaint ID
         */
        async function assignComplaintDepartment(complaintId) {
            // In a real app, this would open a dialog to select department
            const department = prompt('Enter department name (dpcc, transport, environment):');
            
            if (department && ['dpcc', 'transport', 'environment'].includes(department)) {
                try {
                    const result = await MockApiService.updateComplaintStatus(complaintId, 'pending', department);
                    
                    if (result.success) {
                        showAlert('Complaint assigned to department successfully', 'success');
                        
                        // Reload the current section
                        const activeSection = document.querySelector('.content-section.active').id;
                        const sectionName = activeSection.replace('-section-content', '');
                        loadSectionData(sectionName);
                    } else {
                        showAlert('Failed to assign complaint: ' + result.detail, 'error');
                    }
                } catch (error) {
                    showAlert('Failed to assign complaint. Please try again.', 'error');
                }
            } else if (department) {
                showAlert('Invalid department name. Please use: dpcc, transport, or environment', 'error');
            }
        }
        
        /**
         * Submit policy rating
         * @param {string} policy - Policy name
         */
        function submitPolicyRating(policy) {
            PolicyRatingManager.submitPolicyRating(policy);
        }
        
        // ===== SECTION LOADING FUNCTIONS =====
        
        /**
         * Load dashboard data
         */
        function loadDashboardData() {
            DashboardManager.loadDashboardData();
        }
        
        /**
         * Initialize complaint form
         */
        function initializeComplaintForm() {
            ComplaintManager.initializeComplaintForm();
        }
        
        /**
         * Load user complaints
         */
        function loadUserComplaints() {
            ComplaintManager.loadUserComplaints();
        }
        
        /**
         * Load AQI shelters
         */
        function loadAQIShelters() {
            AQISheltersManager.loadAQIShelters();
        }
        
        /**
         * Load insurance plans
         */
        function loadInsurancePlans() {
            InsuranceManager.loadInsurancePlans();
        }
        
        /**
         * Load events
         */
        function loadEvents() {
            EventsManager.loadEvents();
        }
        
        /**
         * Initialize policy rating
         */
        function initializePolicyRating() {
            PolicyRatingManager.initializePolicyRating();
        }
        
        /**
         * Load department dashboard
         */
        function loadDepartmentDashboard() {
            ComplaintManager.loadAllComplaints();
        }
        
        /**
         * Load complaint management
         */
        function loadComplaintManagement() {
            ComplaintManager.loadComplaintManagement();
        }
        
        /**
         * Load department reports
         */
        function loadDepartmentReports() {
            DepartmentReportManager.loadDepartmentReports();
        }
        
        /**
         * Load policymaker dashboard
         */
        function loadPolicymakerDashboard() {
            PolicymakerDashboardManager.loadPolicymakerDashboard();
            PolicyRatingManager.loadPolicyRatings();
        }
        
        /**
         * Load policy analysis
         */
        function loadPolicyAnalysis() {
            // This would load policy analysis data
            console.log('Loading policy analysis');
        }
        
        /**
         * Load feedback analysis
         */
        function loadFeedbackAnalysis() {
            PolicyRatingManager.loadPolicyRatings();
        }
        
        /**
         * Initialize AQI map
         */
        function initializeAQIMap() {
            MapManager.initializeAQIMap();
        }
        
        /**
         * Load nearby hospitals
         */
        function loadNearbyHospitals() {
            HospitalManager.loadNearbyHospitals();
        }
        
        /**
         * Initialize AR view
         */
        function initializeARView() {
            // This would initialize AR components in a real app
            console.log('AR view initialized');
        }
        
        /**
         * Load health data
         */
        function loadHealthData() {
            HealthManager.loadHealthData();
        }
        
        /**
         * Load profile data
         */
        function loadProfileData() {
            ProfileManager.loadProfileData();
        }

        // ===== INITIALIZE APPLICATION WHEN DOM IS LOADED =====
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>


<script src='https://www.noupe.com/embed/019ac3d9b09e7f4fb65918cd94859fcb8e9e.js'></script>

</body>
</html>